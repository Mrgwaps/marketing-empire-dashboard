<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marketing Empire - AI Agent Team</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .back-btn {
            display: inline-block;
            padding: 12px 24px;
            background: white;
            color: #667eea;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            margin-bottom: 20px;
            transition: transform 0.2s;
        }

        .back-btn:hover {
            transform: translateY(-2px);
        }

        .agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 24px;
            margin-top: 30px;
        }

        .agent-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .agent-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 50px rgba(0,0,0,0.15);
        }

        .agent-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .agent-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #f0f0f0;
        }

        .agent-info h3 {
            font-size: 1.3rem;
            color: #333;
            margin-bottom: 4px;
        }

        .agent-role {
            color: #666;
            font-size: 0.9rem;
        }

        .agent-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 16px 0;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #666;
            margin-top: 4px;
        }

        .task-list {
            margin-top: 16px;
        }

        .task-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            margin: 4px 0;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .task-icon {
            font-size: 1.2rem;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 12px;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-idle {
            background: #fff3cd;
            color: #856404;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 32px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #999;
        }

        .chat-container {
            margin-top: 24px;
        }

        .chat-messages {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 16px;
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 16px;
        }

        .message {
            margin: 8px 0;
            padding: 12px;
            border-radius: 8px;
        }

        .message.user {
            background: #667eea;
            color: white;
            margin-left: 20%;
        }

        .message.agent {
            background: white;
            margin-right: 20%;
        }

        .chat-input-container {
            display: flex;
            gap: 8px;
        }

        .chat-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
        }

        .send-btn, .voice-btn {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .voice-btn {
            background: #764ba2;
        }

        .voice-btn.recording {
            background: #dc3545;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* Task Input Container */
        .task-input-container {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            padding: 20px;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
            z-index: 999;
        }

        .task-input-container.active {
            display: block;
        }

        .task-input-wrapper {
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            gap: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="dashboard.html" class="back-btn">‚Üê Back to Dashboard</a>
        
        <div class="header">
            <h1>ü§ñ Your AI Agent Team</h1>
            <p>5 specialized agents working 24/7 to grow your marketing empire</p>
        </div>

        <div class="agents-grid" id="agentsGrid">
            <!-- Agents will be dynamically inserted here -->
        </div>
    </div>

    <!-- Agent Detail Modal -->
    <div id="agentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalAgentName"></h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalAgentDetails"></div>
            
            <div class="chat-container">
                <h3>Chat with Agent</h3>
                <div class="chat-messages" id="chatMessages">
                    <!-- Messages appear here -->
                </div>
                <div class="chat-input-container">
                    <input type="text" id="chatInput" class="chat-input" placeholder="Ask me anything...">
                    <button class="voice-btn" onclick="toggleChatVoice()">üé§</button>
                    <button class="send-btn" onclick="sendChatMessage()">Send</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Task Input Container (Bottom Bar) -->
    <div id="taskInputContainer" class="task-input-container">
        <div class="task-input-wrapper">
            <input type="text" id="taskInput" class="chat-input" placeholder="Describe the task (e.g., 'Research top skincare products')">
            <button class="voice-btn" id="voiceInputBtn" onclick="toggleVoiceInput()">üé§</button>
            <button class="send-btn" onclick="submitTask()">Add Task</button>
            <button class="send-btn" onclick="closeModal()" style="background: #dc3545;">Cancel</button>
        </div>
    </div>

    <script>
        // ElevenLabs API Key
        const ELEVENLABS_API_KEY = '37b2d7684ea1b8f85b21cf63b5895567';

        // Agent Data
        const agents = [
            {
                id: 1,
                name: 'Sophia Chen',
                role: 'Content & SEO Strategist',
                avatar: 'https://i.pravatar.cc/150?img=5',
                voice: { voice_id: 'EXAVITQu4vr4xnSDxMaL', name: 'Sarah' },
                stats: {
                    tasks_completed: 247,
                    efficiency_score: 94,
                    total_revenue_generated: 1250
                },
                current_tasks: [
                    '‚úçÔ∏è Creating 3 high-converting Reddit comments',
                    'üìä Researching top luxury skincare posts (24h)'
                ],
                status: 'active'
            },
            {
                id: 2,
                name: 'Marcus Rivera',
                role: 'Data & Analytics Lead',
                avatar: 'https://i.pravatar.cc/150?img=12',
                voice: { voice_id: 'pqHfZKP75CvOlQylNhV4', name: 'Roger' },
                stats: {
                    tasks_completed: 312,
                    efficiency_score: 97,
                    total_revenue_generated: 980
                },
                current_tasks: [
                    'üìà Monitoring Reddit automation performance',
                    'üîó Tracking bit.ly clicks ‚Üí email signups',
                    'üìç Analyzing landing page traffic sources'
                ],
                status: 'active'
            },
            {
                id: 3,
                name: 'Isabella Monroe',
                role: 'Social Media Manager',
                avatar: 'https://i.pravatar.cc/150?img=9',
                voice: { voice_id: 'FGY2WhTYpPnrIDTdsKH5', name: 'Laura' },
                stats: {
                    tasks_completed: 189,
                    efficiency_score: 91,
                    total_revenue_generated: 720
                },
                current_tasks: [
                    'üéØ Identifying 5 high-traffic skincare threads',
                    'üí¨ Creating engagement strategy for r/30PlusSkinCare'
                ],
                status: 'active'
            },
            {
                id: 4,
                name: 'Ava Thompson',
                role: 'Email & Automation Specialist',
                avatar: 'https://i.pravatar.cc/150?img=16',
                voice: { voice_id: 'ThT5KcBeYPX3keUQqHPh', name: 'Alice' },
                stats: {
                    tasks_completed: 203,
                    efficiency_score: 88,
                    total_revenue_generated: 1050
                },
                current_tasks: [
                    '‚úâÔ∏è Verifying Brevo email sequence triggers',
                    'üß™ Testing full funnel: landing ‚Üí emails ‚Üí affiliate',
                    'üìß Optimizing email subject lines for open rates'
                ],
                status: 'active'
            },
            {
                id: 5,
                name: 'Daniel Cross',
                role: 'Campaign & Ads Specialist',
                avatar: 'https://i.pravatar.cc/150?img=33',
                voice: { voice_id: 'XB0fDUnXU5powFXDhCwa', name: 'Charlie' },
                stats: {
                    tasks_completed: 156,
                    efficiency_score: 92,
                    total_revenue_generated: 890
                },
                current_tasks: [
                    'üîç Researching free traffic sources (Quora, forums)',
                    'üí∞ Identifying high-commission Amazon products',
                    'üìÖ Creating multi-platform promotional calendar'
                ],
                status: 'active'
            }
        ];


        // Cached voice responses for instant playback (quick greetings)
        const voiceCache = {
            'sophia': 'https://temp.composio.dev/elevenlabs/sophia_greeting.mp3', // "Hey! I'm Sophia, ready to create content that converts!"
            'marcus': 'https://temp.composio.dev/elevenlabs/marcus_greeting.mp3', // "Marcus here. Let's analyze the data and optimize performance."
            'isabella': 'https://temp.composio.dev/elevenlabs/isabella_greeting.mp3', // "Hi! Isabella ready to engage our community!"
            'ava': 'https://temp.composio.dev/elevenlabs/ava_greeting.mp3', // "Ava here! Email automation is my specialty!"
            'daniel': 'https://temp.composio.dev/elevenlabs/daniel_greeting.mp3' // "Daniel reporting in. Let's run some high-impact campaigns!"
        };


        // Play cached voice + generate live task speech
        async function playAgentVoice(agentId) {
            const agent = agents.find(a => a.id === agentId);
            if (!agent) return;

            // Play cached greeting instantly for quick feedback
            const cachedAudio = new Audio(voiceCache[agentId]);
            cachedAudio.volume = 0.8;
            cachedAudio.play().catch(err => console.log('Cached audio play failed:', err));

            // In parallel, generate live task speech via ElevenLabs API
            try {
                const nextTask = agent.tasks.find(t => t.status === 'in-progress') || agent.tasks[0];
                if (!nextTask) return;

                // Personality-based task announcement
                const personalities = {
                    'sophia': `Here's what I'm working on: ${nextTask.title}. ${nextTask.description}`,
                    'marcus': `Current focus: ${nextTask.title}. ${nextTask.description}`,
                    'isabella': `On it! ${nextTask.title}. ${nextTask.description}`,
                    'ava': `Working on: ${nextTask.title}. ${nextTask.description}`,
                    'daniel': `Let's go! ${nextTask.title}. ${nextTask.description}`
                };

                const taskText = personalities[agentId] || nextTask.description;

                // Generate speech via ElevenLabs (this happens in background while greeting plays)
                const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${agent.voiceId}`, {
                    method: 'POST',
                    headers: {
                        'Accept': 'audio/mpeg',
                        'Content-Type': 'application/json',
                        'xi-api-key': '37b2d7684ea1b8f85b21cf63b5895567'
                    },
                    body: JSON.stringify({
                        text: taskText,
                        model_id: 'eleven_monolingual_v1',
                        voice_settings: {
                            stability: 0.5,
                            similarity_boost: 0.75
                        }
                    })
                });

                if (response.ok) {
                    const audioBlob = await response.blob();
                    const audioUrl = URL.createObjectURL(audioBlob);

                    // Queue the task speech to play after greeting finishes
                    cachedAudio.addEventListener('ended', () => {
                        const taskAudio = new Audio(audioUrl);
                        taskAudio.volume = 0.8;
                        taskAudio.play().catch(err => console.log('Task audio play failed:', err));
                    });
                }
            } catch (err) {
                console.log('Live task speech generation failed:', err);
                // No problem - cached greeting already played
            }
        }


        // Chat history (in-memory storage)
        const chatHistory = {};

        // Speech recognition setup
        const recognition = window.SpeechRecognition || window.webkitSpeechRecognition 
            ? new (window.SpeechRecognition || window.webkitSpeechRecognition)() 
            : null;

        if (recognition) {
            recognition.lang = 'en-US';
            recognition.continuous = false;
        }

        // Initialize
        let currentAgent = null;

        function init() {
            // Check authentication
            const isAuthenticated = localStorage.getItem('isAuthenticated');
            if (isAuthenticated !== 'true') {
                window.location.href = 'login.html';
                return;
            }

            // Render agents
            renderAgents();
        }

        function renderAgents() {
            const grid = document.getElementById('agentsGrid');
            
            agents.forEach(agent => {
                const card = document.createElement('div');
                card.className = 'agent-card';
                card.onclick = () => openAgentModal(agent);
                
                card.innerHTML = `
                    <div class="agent-header">
                        <img src="${agent.avatar}" alt="${agent.name}" class="agent-avatar">
                        <div class="agent-info">
                            <h3>${agent.name}</h3>
                            <div class="agent-role">${agent.role}</div>
                        </div>
                    </div>
                    
                    <div class="agent-stats">
                        <div class="stat">
                            <div class="stat-value">${agent.stats.tasks_completed}</div>
                            <div class="stat-label">Tasks Done</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${agent.stats.efficiency_score}%</div>
                            <div class="stat-label">Efficiency</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">$${agent.stats.total_revenue_generated}</div>
                            <div class="stat-label">Revenue</div>
                        </div>
                    </div>
                    
                    <div class="task-list">
                        <strong>Current Tasks:</strong>
                        ${agent.current_tasks.map(task => `
                            <div class="task-item">
                                <span class="task-icon">üìå</span>
                                <span>${task}</span>
                            </div>
                        `).join('')}
                    </div>
                    
                    <span class="status-badge status-${agent.status}">
                        ${agent.status === 'active' ? 'üü¢ Active' : 'üü° Idle'}
                    </span>
                `;
                
                grid.appendChild(card);
            });
        }

        async function openAgentModal(agent) {
            currentAgent = agent;
            
            // Set modal content
            document.getElementById('modalAgentName').textContent = agent.name;
            document.getElementById('agentModal').classList.add('active');
            
            // Initialize chat history
            if (!chatHistory[agent.id]) {
                chatHistory[agent.id] = [];
            }
            
            renderChatHistory(agent);
            
            // Agent speaks their next task
            const taskText = agent.current_tasks[0] || "I'm ready for a new task!";
            
            try {
                const audioUrl = await generateSpeech(taskText, agent.voice.voice_id);
                const audio = new Audio(audioUrl);
                await audio.play();
            } catch (error) {
                console.error('Error playing speech:', error);
            }
        }

        async function generateSpeech(text, voiceId) {
            const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${voiceId}`, {
                method: 'POST',
                headers: {
                    'Accept': 'audio/mpeg',
                    'Content-Type': 'application/json',
                    'xi-api-key': ELEVENLABS_API_KEY
                },
                body: JSON.stringify({
                    text: text,
                    model_id: 'eleven_monolingual_v1',
                    voice_settings: {
                        stability: 0.5,
                        similarity_boost: 0.75
                    }
                })
            });

            if (!response.ok) {
                throw new Error('Failed to generate speech');
            }

            const blob = await response.blob();
            return URL.createObjectURL(blob);
        }

        function renderChatHistory(agent) {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = '';
            
            const history = chatHistory[agent.id] || [];
            
            if (history.length === 0) {
                chatMessages.innerHTML = '<p style="text-align: center; color: #999;">Start a conversation...</p>';
                return;
            }
            
            history.forEach(msg => {
                const msgDiv = document.createElement('div');
                msgDiv.className = `message ${msg.sender}`;
                msgDiv.textContent = msg.text;
                chatMessages.appendChild(msgDiv);
            });
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        async function sendChatMessage() {
            if (!currentAgent) return;
            
            const input = document.getElementById('chatInput');
            const userMessage = input.value.trim();
            
            if (!userMessage) return;
            
            // Add user message
            chatHistory[currentAgent.id].push({
                sender: 'user',
                text: userMessage
            });
            
            // Generate agent response
            const agentResponse = generateAgentResponse(userMessage, currentAgent);
            
            chatHistory[currentAgent.id].push({
                sender: 'agent',
                text: agentResponse
            });

            // Re-render chat
            renderChatHistory(currentAgent);

            // Clear input
            input.value = '';

            // Scroll to bottom
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Agent speaks response
            try {
                const audioUrl = await generateSpeech(agentResponse, currentAgent.voice.voice_id);
                const audio = new Audio(audioUrl);
                await audio.play();
            } catch (error) {
                console.error('Error playing response:', error);
            }
        }

        // Generate agent response (simplified - in production, use LLM)
        function generateAgentResponse(userMessage, agent) {
            const lowerMessage = userMessage.toLowerCase();

            if (lowerMessage.includes('task') || lowerMessage.includes('working on')) {
                return `I'm currently working on ${agent.current_tasks.length} tasks. My top priority right now is: ${agent.current_tasks[0] || 'waiting for new assignments'}.`;
            } else if (lowerMessage.includes('revenue') || lowerMessage.includes('money') || lowerMessage.includes('earn')) {
                return `Great question! Based on our current strategy, I've contributed to $${agent.stats.total_revenue_generated} in revenue. I'm constantly optimizing to increase that number!`;
            } else if (lowerMessage.includes('efficiency') || lowerMessage.includes('improve') || lowerMessage.includes('better')) {
                return `My current efficiency score is ${agent.stats.efficiency_score}%. I'm always learning and adapting. Give me more tasks and I'll show you what I can do!`;
            } else {
                return `I understand you're asking about "${userMessage}". As your ${agent.role}, I'm here to help optimize our marketing strategy. What specific area would you like to focus on?`;
            }
        }

        // Toggle voice input for tasks
        function toggleVoiceInput() {
            if (!recognition) {
                alert('Speech recognition is not supported in your browser.');
                return;
            }

            const btn = document.getElementById('voiceInputBtn');

            if (btn.classList.contains('recording')) {
                recognition.stop();
                btn.classList.remove('recording');
            } else {
                btn.classList.add('recording');
                recognition.start();

                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('taskInput').value = transcript;
                    btn.classList.remove('recording');
                };

                recognition.onerror = () => {
                    btn.classList.remove('recording');
                };
            }
        }

        // Toggle voice input for chat
        function toggleChatVoice() {
            if (!recognition) {
                alert('Speech recognition is not supported in your browser.');
                return;
            }

            recognition.start();

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                document.getElementById('chatInput').value = transcript;
            };
        }

        // Close modal
        function closeModal() {
            document.getElementById('agentModal').classList.remove('active');
            document.getElementById('taskInputContainer').classList.remove('active');
            currentAgent = null;
        }

        // Enter key handlers
        document.getElementById('taskInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') submitTask();
        });

        document.getElementById('chatInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendChatMessage();
        });

        // Initialize on load
        window.onload = init;
    </script>
</body>
</html>