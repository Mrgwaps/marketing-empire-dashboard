<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marketing Empire - AI Agent Team</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .back-btn {
            display: inline-block;
            padding: 12px 24px;
            background: white;
            color: #667eea;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            margin-bottom: 20px;
            transition: transform 0.2s;
        }

        .back-btn:hover {
            transform: translateY(-2px);
        }

        .agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 24px;
            margin-top: 30px;
        }

        .agent-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .agent-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 50px rgba(0,0,0,0.15);
        }

        .agent-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .agent-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #f0f0f0;
        }

        .agent-info h3 {
            font-size: 1.3rem;
            color: #333;
            margin-bottom: 4px;
        }

        .agent-role {
            color: #666;
            font-size: 0.9rem;
        }

        .agent-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 16px 0;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #666;
            margin-top: 4px;
        }

        .task-list {
            margin-top: 16px;
        }

        .task-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            margin: 4px 0;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .task-icon {
            font-size: 1.2rem;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 12px;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-idle {
            background: #fff3cd;
            color: #856404;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 32px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #999;
        }

        .chat-container {
            margin-top: 24px;
        }

        .chat-messages {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 16px;
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 16px;
        }

        .message {
            margin: 8px 0;
            padding: 12px;
            border-radius: 8px;
        }

        .message.user {
            background: #667eea;
            color: white;
            margin-left: 20%;
        }

        .message.agent {
            background: white;
            margin-right: 20%;
        }

        .chat-input-container {
            display: flex;
            gap: 8px;
        }

        .chat-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
        }

        .send-btn, .voice-btn {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .voice-btn {
            background: #764ba2;
        }

        .voice-btn.recording {
            background: #dc3545;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* Task Input Container */
        .task-input-container {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            padding: 20px;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
            z-index: 999;
        }

        .task-input-container.active {
            display: block;
        }

        .task-input-wrapper {
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            gap: 12px;
        }
    
        /* Agent Brain Styles */
        .agent-brain {
            padding: 20px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 12px;
            margin-top: 15px;
        }

        .agent-brain h3 {
            color: #00d4ff;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .memory-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .memory-section h4 {
            color: #fff;
            font-size: 1.1em;
            margin-bottom: 12px;
        }

        .memory-buffer {
            max-height: 300px;
            overflow-y: auto;
        }

        .memory-message {
            display: flex;
            gap: 10px;
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 6px;
            align-items: flex-start;
        }

        .memory-message.user {
            background: rgba(0, 212, 255, 0.1);
        }

        .memory-message.agent {
            background: rgba(124, 58, 237, 0.1);
        }

        .memory-role {
            font-size: 1.2em;
            flex-shrink: 0;
        }

        .memory-text {
            flex: 1;
            color: #fff;
            font-size: 0.9em;
        }

        .memory-time {
            color: #888;
            font-size: 0.8em;
            flex-shrink: 0;
        }

        .skills-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .skill-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .memory-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .stat-label {
            color: #aaa;
            font-size: 0.85em;
        }

        .stat-value {
            color: #00d4ff;
            font-size: 1.3em;
            font-weight: bold;
        }

        .clear-memory-btn {
            width: 100%;
            margin-top: 15px;
            padding: 12px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .clear-memory-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }

        .btn-brain {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .btn-brain:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
</style>
</head>
<body>
    <div class="container">
        <a href="dashboard.html" class="back-btn">‚Üê Back to Dashboard</a>
        
        <div class="header">
            <h1>ü§ñ Your AI Agent Team</h1>
            <p>5 specialized agents working 24/7 to grow your marketing empire</p>
        </div>

        <div class="agents-grid" id="agentsGrid">
            <!-- Agents will be dynamically inserted here -->
        </div>
    </div>

    <!-- Agent Detail Modal -->
    <div id="agentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalAgentName"></h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalAgentDetails"></div>
            
            <div class="chat-container">
                <h3>Chat with Agent</h3>
                <div class="chat-messages" id="chatMessages">
                    <!-- Messages appear here -->
                </div>
                <div class="chat-input-container">
                    <input type="text" id="chatInput" class="chat-input" placeholder="Ask me anything...">
                    <button class="voice-btn" onclick="toggleChatVoice()">üé§</button>
                    <button class="send-btn" onclick="sendChatMessage()">Send</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Task Input Container (Bottom Bar) -->
    <div id="taskInputContainer" class="task-input-container">
        <div class="task-input-wrapper">
            <input type="text" id="taskInput" class="chat-input" placeholder="Describe the task (e.g., 'Research top skincare products')">
            <button class="voice-btn" id="voiceInputBtn" onclick="toggleVoiceInput()">üé§</button>
            <button class="send-btn" onclick="submitTask()">Add Task</button>
            <button class="send-btn" onclick="closeModal()" style="background: #dc3545;">Cancel</button>
        </div>
    </div>

    <script>
        // ElevenLabs API Key
        const ELEVENLABS_API_KEY = '37b2d7684ea1b8f85b21cf63b5895567';

        // Agent Data
        const agents = [
            {
                id: 1,
                name: 'Sophia Chen',
                role: 'Content & SEO Strategist',
                avatar: 'https://i.pravatar.cc/150?img=5',
                voice: { voice_id: 'EXAVITQu4vr4xnSDxMaL', name: 'Sarah' },
                stats: {
                    tasks_completed: 247,
                    efficiency_score: 94,
                    total_revenue_generated: 1250
                },
                current_tasks: [
                    '‚úçÔ∏è Creating 3 high-converting Reddit comments',
                    'üìä Researching top luxury skincare posts (24h)'
                ],
                status: 'active'
            },
            {
                id: 2,
                name: 'Marcus Rivera',
                role: 'Data & Analytics Lead',
                avatar: 'https://i.pravatar.cc/150?img=12',
                voice: { voice_id: 'pqHfZKP75CvOlQylNhV4', name: 'Roger' },
                stats: {
                    tasks_completed: 312,
                    efficiency_score: 97,
                    total_revenue_generated: 980
                },
                current_tasks: [
                    'üìà Monitoring Reddit automation performance',
                    'üîó Tracking bit.ly clicks ‚Üí email signups',
                    'üìç Analyzing landing page traffic sources'
                ],
                status: 'active'
            },
            {
                id: 3,
                name: 'Isabella Monroe',
                role: 'Social Media Manager',
                avatar: 'https://i.pravatar.cc/150?img=9',
                voice: { voice_id: 'FGY2WhTYpPnrIDTdsKH5', name: 'Laura' },
                stats: {
                    tasks_completed: 189,
                    efficiency_score: 91,
                    total_revenue_generated: 720
                },
                current_tasks: [
                    'üéØ Identifying 5 high-traffic skincare threads',
                    'üí¨ Creating engagement strategy for r/30PlusSkinCare'
                ],
                status: 'active'
            },
            {
                id: 4,
                name: 'Ava Thompson',
                role: 'Email & Automation Specialist',
                avatar: 'https://i.pravatar.cc/150?img=16',
                voice: { voice_id: 'ThT5KcBeYPX3keUQqHPh', name: 'Alice' },
                stats: {
                    tasks_completed: 203,
                    efficiency_score: 88,
                    total_revenue_generated: 1050
                },
                current_tasks: [
                    '‚úâÔ∏è Verifying Brevo email sequence triggers',
                    'üß™ Testing full funnel: landing ‚Üí emails ‚Üí affiliate',
                    'üìß Optimizing email subject lines for open rates'
                ],
                status: 'active'
            },
            {
                id: 5,
                name: 'Daniel Cross',
                role: 'Campaign & Ads Specialist',
                avatar: 'https://i.pravatar.cc/150?img=33',
                voice: { voice_id: 'XB0fDUnXU5powFXDhCwa', name: 'Charlie' },
                stats: {
                    tasks_completed: 156,
                    efficiency_score: 92,
                    total_revenue_generated: 890
                },
                current_tasks: [
                    'üîç Researching free traffic sources (Quora, forums)',
                    'üí∞ Identifying high-commission Amazon products',
                    'üìÖ Creating multi-platform promotional calendar'
                ],
                status: 'active'
            }
        ];

        // Chat history (in-memory storage)
        const chatHistory = {};

        // Speech recognition setup
        const recognition = window.SpeechRecognition || window.webkitSpeechRecognition 
            ? new (window.SpeechRecognition || window.webkitSpeechRecognition)() 
            : null;

        if (recognition) {
            recognition.lang = 'en-US';
            recognition.continuous = false;
        }

        // Initialize
        let currentAgent = null;

        function init() {
            // Check authentication
            const isAuthenticated = localStorage.getItem('isAuthenticated');
            if (isAuthenticated !== 'true') {
                window.location.href = 'login.html';
                return;
            }

            // Render agents
            renderAgents();
        }

        function renderAgents() {
            const grid = document.getElementById('agentsGrid');
            
            agents.forEach(agent => {
                const card = document.createElement('div');
                card.className = 'agent-card';
                card.onclick = () => openAgentModal(agent);
                
                card.innerHTML = `
                    <div class="agent-header">
                        <img src="${agent.avatar}" alt="${agent.name}" class="agent-avatar">
                        <div class="agent-info">
                            <h3>${agent.name}</h3>
                            <div class="agent-role">${agent.role}</div>
                        </div>
                    </div>
                    
                    <div class="agent-stats">
                        <div class="stat">
                            <div class="stat-value">${agent.stats.tasks_completed}</div>
                            <div class="stat-label">Tasks Done</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${agent.stats.efficiency_score}%</div>
                            <div class="stat-label">Efficiency</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">$${agent.stats.total_revenue_generated}</div>
                            <div class="stat-label">Revenue</div>
                        </div>
                    </div>
                    
                    <div class="task-list">
                        <strong>Current Tasks:</strong>
                        ${agent.current_tasks.map(task => `
                            <div class="task-item">
                                <span class="task-icon">üìå</span>
                                <span>${task}</span>
                            </div>
                        `).join('')}
                    </div>
                    
                    <span class="status-badge status-${agent.status}">
                        ${agent.status === 'active' ? 'üü¢ Active' : 'üü° Idle'}
                    </span>
                `;
                
                grid.appendChild(card);
            });
        }

        async function openAgentModal(agent) {
            currentAgent = agent;
            
            // Set modal content
            document.getElementById('modalAgentName').textContent = agent.name;
            document.getElementById('agentModal').classList.add('active');
            
            // Initialize chat history
            if (!chatHistory[agent.id]) {
                chatHistory[agent.id] = [];
            }
            
            renderChatHistory(agent);
            
            // Agent speaks their next task
            const taskText = agent.current_tasks[0] || "I'm ready for a new task!";
            
            try {
                const audioUrl = await generateSpeech(taskText, agent.voice.voice_id);
                const audio = new Audio(audioUrl);
                await audio.play();
            } catch (error) {
                console.error('Error playing speech:', error);
            }
        }

        async function generateSpeech(text, voiceId) {
            const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${voiceId}`, {
                method: 'POST',
                headers: {
                    'Accept': 'audio/mpeg',
                    'Content-Type': 'application/json',
                    'xi-api-key': ELEVENLABS_API_KEY
                },
                body: JSON.stringify({
                    text: text,
                    model_id: 'eleven_monolingual_v1',
                    voice_settings: {
                        stability: 0.5,
                        similarity_boost: 0.75
                    }
                })
            });

            if (!response.ok) {
                throw new Error('Failed to generate speech');
            }

            const blob = await response.blob();
            return URL.createObjectURL(blob);
        }

        function renderChatHistory(agent) {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = '';
            
            const history = chatHistory[agent.id] || [];
            
            if (history.length === 0) {
                chatMessages.innerHTML = '<p style="text-align: center; color: #999;">Start a conversation...</p>';
                return;
            }
            
            history.forEach(msg => {
                const msgDiv = document.createElement('div');
                msgDiv.className = `message ${msg.sender}`;
                msgDiv.textContent = msg.text;
                chatMessages.appendChild(msgDiv);
            });
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        async function sendChatMessage() {
            if (!currentAgent) return;
            
            const input = document.getElementById('chatInput');
            const userMessage = input.value.trim();
            
            if (!userMessage) return;
            
            // Add user message
            chatHistory[currentAgent.id].push({
                sender: 'user',
                text: userMessage
            });
            
            // Generate agent response
            const agentResponse = generateAgentResponse(userMessage, currentAgent);
            
            chatHistory[currentAgent.id].push({
                sender: 'agent',
                text: agentResponse
            });

            // Re-render chat
            renderChatHistory(currentAgent);

            // Clear input
            input.value = '';

            // Scroll to bottom
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Agent speaks response
            try {
                const audioUrl = await generateSpeech(agentResponse, currentAgent.voice.voice_id);
                const audio = new Audio(audioUrl);
                await audio.play();
            } catch (error) {
                console.error('Error playing response:', error);
            }
        }

        // Generate agent response (simplified - in production, use LLM)
        function generateAgentResponse(userMessage, agent) {
            const lowerMessage = userMessage.toLowerCase();

            if (lowerMessage.includes('task') || lowerMessage.includes('working on')) {
                return `I'm currently working on ${agent.current_tasks.length} tasks. My top priority right now is: ${agent.current_tasks[0] || 'waiting for new assignments'}.`;
            } else if (lowerMessage.includes('revenue') || lowerMessage.includes('money') || lowerMessage.includes('earn')) {
                return `Great question! Based on our current strategy, I've contributed to $${agent.stats.total_revenue_generated} in revenue. I'm constantly optimizing to increase that number!`;
            } else if (lowerMessage.includes('efficiency') || lowerMessage.includes('improve') || lowerMessage.includes('better')) {
                return `My current efficiency score is ${agent.stats.efficiency_score}%. I'm always learning and adapting. Give me more tasks and I'll show you what I can do!`;
            } else {
                return `I understand you're asking about "${userMessage}". As your ${agent.role}, I'm here to help optimize our marketing strategy. What specific area would you like to focus on?`;
            }
        }

        // Toggle voice input for tasks
        function toggleVoiceInput() {
            if (!recognition) {
                alert('Speech recognition is not supported in your browser.');
                return;
            }

            const btn = document.getElementById('voiceInputBtn');

            if (btn.classList.contains('recording')) {
                recognition.stop();
                btn.classList.remove('recording');
            } else {
                btn.classList.add('recording');
                recognition.start();

                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('taskInput').value = transcript;
                    btn.classList.remove('recording');
                };

                recognition.onerror = () => {
                    btn.classList.remove('recording');
                };
            }
        }

        // Toggle voice input for chat
        function toggleChatVoice() {
            if (!recognition) {
                alert('Speech recognition is not supported in your browser.');
                return;
            }

            recognition.start();

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                document.getElementById('chatInput').value = transcript;
            };
        }

        // Close modal
        function closeModal() {
            document.getElementById('agentModal').classList.remove('active');
            document.getElementById('taskInputContainer').classList.remove('active');
            currentAgent = null;
        }

        // Enter key handlers
        document.getElementById('taskInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') submitTask();
        });

        document.getElementById('chatInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendChatMessage();
        });

        // Initialize on load
        window.onload = init;
    
        // ============================================================
        // VOICE FEATURE - Speak when card clicked
        // ============================================================
        const ELEVENLABS_API_KEY = '37b2d7684ea1b8f85b21cf63b5895567';
        const audioCache = new Map(); // Cache for instant playback

        // Cached greetings for instant response
        const cachedGreetings = {
            sophia: "Hi! I'm Sophia, your Content & SEO Strategist. Let me tell you what I'm working on...",
            marcus: "Hey there! Marcus here, your Data & Analytics Lead. Here's what's on my radar...",
            isabella: "Hello! Isabella, Social Media Manager at your service. My current focus is...",
            ava: "Hi! I'm Ava, Email & Automation Specialist. Let me share my priorities...",
            daniel: "What's up! Daniel here, Campaign & Ads Specialist. Here's what I'm tackling..."
        };

        // Agent voices (ElevenLabs voice IDs)
        const agentVoices = {
            sophia: 'EXAVITQu4vr4xnSDxMaL', // Sarah - professional female
            marcus: 'TxGEqnHWrfWFTfGW9XjX', // Josh - confident male
            isabella: '21m00Tcm4TlvDq8ikWAM', // Rachel - warm female
            ava: 'pNInz6obpgDQGcFmaJgB', // Bella - energetic female
            daniel: 'yoZ06aMxZJJ28mfd3POQ' // Antoni - professional male
        };

        // Speak function using ElevenLabs
        async function speakText(text, voiceId) {
            // Check cache first for instant playback
            const cacheKey = text + voiceId;
            if (audioCache.has(cacheKey)) {
                const audio = audioCache.get(cacheKey).cloneNode();
                audio.play();
                return;
            }

            try {
                const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${voiceId}`, {
                    method: 'POST',
                    headers: {
                        'Accept': 'audio/mpeg',
                        'Content-Type': 'application/json',
                        'xi-api-key': ELEVENLABS_API_KEY
                    },
                    body: JSON.stringify({
                        text: text,
                        model_id: 'eleven_monolingual_v1',
                        voice_settings: {
                            stability: 0.5,
                            similarity_boost: 0.75
                        }
                    })
                });

                if (!response.ok) throw new Error('Speech API failed');

                const audioBlob = await response.blob();
                const audioUrl = URL.createObjectURL(audioBlob);
                const audio = new Audio(audioUrl);

                // Cache for next time
                audioCache.set(cacheKey, audio.cloneNode());

                audio.play();
            } catch (error) {
                console.error('Speech failed:', error);
            }
        }

        // Enhanced expandAgent with voice + brain feature
        function expandAgent(agentId) {
            const card = document.getElementById(agentId);
            const allCards = document.querySelectorAll('.agent-card');

            // Collapse all others
            allCards.forEach(c => {
                if (c.id !== agentId) {
                    c.classList.remove('expanded');
                    const details = c.querySelector('.agent-details');
                    const brain = c.querySelector('.agent-brain');
                    if (details) details.style.display = 'none';
                    if (brain) brain.style.display = 'none';
                }
            });

            // Toggle this card
            const isExpanding = !card.classList.contains('expanded');
            card.classList.toggle('expanded');

            const details = card.querySelector('.agent-details');
            const brain = card.querySelector('.agent-brain');

            if (isExpanding) {
                if (details) details.style.display = 'block';
                if (brain) brain.style.display = 'none'; // Hide brain initially

                // VOICE: Play cached greeting instantly, then get full task
                const greeting = cachedGreetings[agentId];
                const voiceId = agentVoices[agentId];

                if (greeting && voiceId) {
                    // Instant cached response
                    speakText(greeting, voiceId);

                    // Parallel: fetch full next task and speak
                    setTimeout(() => {
                        const fullTask = getAgentNextTask(agentId);
                        if (fullTask !== greeting) {
                            speakText(fullTask, voiceId);
                        }
                    }, 100);
                }
            } else {
                if (details) details.style.display = 'none';
                if (brain) brain.style.display = 'none';
            }
        }

        // Get agent's next task in their personality
        function getAgentNextTask(agentId) {
            const tasks = {
                sophia: "I'm crafting 3 high-converting Reddit comments for our next automation run, researching top luxury skincare posts from the last 24 hours to find perfect opportunities!",
                marcus: "I'm monitoring our Reddit automation performance to optimize timing, tracking landing page traffic sources in Airtable, and setting up conversion tracking from bit.ly clicks to email signups!",
                isabella: "I'm identifying 5 high-traffic skincare threads for manual karma building and creating an engagement strategy for r/30PlusSkinCare to boost our community presence!",
                ava: "I'm verifying our Brevo email sequences trigger properly on signup, testing the full funnel from landing page through all 5 emails to affiliate links, and optimizing subject lines for higher open rates!",
                daniel: "I'm researching free traffic sources beyond Reddit like Quora, forums, and Facebook groups, identifying Amazon affiliate products with the highest commission rates, and creating a promotional calendar for our multi-platform traffic push!"
            };
            return tasks[agentId] || cachedGreetings[agentId];
        }

        // ============================================================
        // AGENT BRAIN FEATURE - Memory Viewer
        // ============================================================
        function toggleAgentBrain(agentId) {
            const card = document.getElementById(agentId);
            const details = card.querySelector('.agent-details');
            const brain = card.querySelector('.agent-brain');

            if (brain.style.display === 'block') {
                // Hide brain, show details
                brain.style.display = 'none';
                details.style.display = 'block';
            } else {
                // Show brain, hide details
                details.style.display = 'none';
                brain.style.display = 'block';
                loadAgentMemory(agentId);
            }
        }

        function loadAgentMemory(agentId) {
            // Simulate loading agent memory (last 10 exchanges, learned skills, stats)
            const memoryData = {
                sophia: {
                    buffer: [
                        { role: 'user', content: 'Create Reddit comments for skincare posts', time: '2 hours ago' },
                        { role: 'agent', content: 'Generated 3 high-converting comments targeting luxury beauty enthusiasts', time: '2 hours ago' },
                        { role: 'user', content: 'Research top-performing posts', time: '4 hours ago' },
                        { role: 'agent', content: 'Analyzed 50 posts, identified 12 high-opportunity threads', time: '4 hours ago' }
                    ],
                    skills: ['SEO optimization', 'Content strategy', 'Reddit engagement', 'Luxury beauty expertise'],
                    stats: { tasks: 47, success: 45, tokens: 125000 }
                },
                marcus: {
                    buffer: [
                        { role: 'user', content: 'Track Reddit automation performance', time: '1 hour ago' },
                        { role: 'agent', content: 'Updated Airtable with 12 new data points, engagement up 23%', time: '1 hour ago' },
                        { role: 'user', content: 'Set up conversion tracking', time: '3 hours ago' },
                        { role: 'agent', content: 'Configured bit.ly ‚Üí email signup funnel tracking', time: '3 hours ago' }
                    ],
                    skills: ['Data analysis', 'Airtable automation', 'Performance tracking', 'Conversion optimization'],
                    stats: { tasks: 52, success: 51, tokens: 98000 }
                },
                isabella: {
                    buffer: [
                        { role: 'user', content: 'Find high-traffic threads', time: '30 min ago' },
                        { role: 'agent', content: 'Identified 5 threads with 200+ comments, perfect for engagement', time: '30 min ago' },
                        { role: 'user', content: 'Create engagement strategy', time: '5 hours ago' },
                        { role: 'agent', content: 'Built 7-day strategy for r/30PlusSkinCare community growth', time: '5 hours ago' }
                    ],
                    skills: ['Social media strategy', 'Community management', 'Reddit expertise', 'Engagement tactics'],
                    stats: { tasks: 38, success: 37, tokens: 87000 }
                },
                ava: {
                    buffer: [
                        { role: 'user', content: 'Test email funnel', time: '1 hour ago' },
                        { role: 'agent', content: 'Tested full sequence, all 5 emails delivering correctly', time: '1 hour ago' },
                        { role: 'user', content: 'Optimize subject lines', time: '6 hours ago' },
                        { role: 'agent', content: 'A/B tested 10 variations, increased open rate by 18%', time: '6 hours ago' }
                    ],
                    skills: ['Email automation', 'Brevo expertise', 'Funnel optimization', 'A/B testing'],
                    stats: { tasks: 43, success: 42, tokens: 102000 }
                },
                daniel: {
                    buffer: [
                        { role: 'user', content: 'Research traffic sources', time: '2 hours ago' },
                        { role: 'agent', content: 'Found 8 new platforms: Quora, Beauty forums, FB groups', time: '2 hours ago' },
                        { role: 'user', content: 'Find high-commission products', time: '4 hours ago' },
                        { role: 'agent', content: 'Identified 15 luxury products with 10%+ commission rates', time: '4 hours ago' }
                    ],
                    skills: ['Traffic generation', 'Affiliate marketing', 'Campaign planning', 'Multi-platform strategy'],
                    stats: { tasks: 35, success: 34, tokens: 79000 }
                }
            };

            const data = memoryData[agentId];
            const memoryContent = document.querySelector(`#${agentId} .memory-content`);

            memoryContent.innerHTML = `
                <div class="memory-section">
                    <h4>üìù Memory Buffer (Last ${data.buffer.length} exchanges)</h4>
                    <div class="memory-buffer">
                        ${data.buffer.map(msg => `
                            <div class="memory-message ${msg.role}">
                                <span class="memory-role">${msg.role === 'user' ? 'üë§' : 'ü§ñ'}</span>
                                <span class="memory-text">${msg.content}</span>
                                <span class="memory-time">${msg.time}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div class="memory-section">
                    <h4>üß† Learned Skills</h4>
                    <div class="skills-list">
                        ${data.skills.map(skill => `<span class="skill-badge">${skill}</span>`).join('')}
                    </div>
                </div>

                <div class="memory-section">
                    <h4>üìä Memory Statistics</h4>
                    <div class="memory-stats">
                        <div class="stat-item">
                            <span class="stat-label">Tasks Completed:</span>
                            <span class="stat-value">${data.stats.tasks}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Success Rate:</span>
                            <span class="stat-value">${((data.stats.success / data.stats.tasks) * 100).toFixed(1)}%</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Tokens Used:</span>
                            <span class="stat-value">${data.stats.tokens.toLocaleString()}</span>
                        </div>
                    </div>
                </div>

                <button class="clear-memory-btn" onclick="clearAgentMemory('${agentId}')">
                    üóëÔ∏è Clear Memory
                </button>
            `;
        }

        function clearAgentMemory(agentId) {
            if (confirm(`Clear all memory for ${agentId.charAt(0).toUpperCase() + agentId.slice(1)}?`)) {
                alert('Memory cleared! (Demo mode - in production this would reset agent memory)');
                toggleAgentBrain(agentId); // Close brain view
            }
        }
</script>
</body>
</html>