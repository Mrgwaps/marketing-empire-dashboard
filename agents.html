<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marketing Empire - AI Agent Team</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .agent-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .agent-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .agent-card.speaking {
            animation: pulse 2s ease-in-out infinite;
            border: 3px solid #667eea;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .agent-avatar {
            width: 100%;
            height: 300px;
            object-fit: cover;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .agent-info {
            padding: 25px;
        }

        .agent-name {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .agent-role {
            font-size: 1em;
            color: #667eea;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .agent-personality {
            font-size: 0.95em;
            color: #666;
            font-style: italic;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .agent-skills {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .skill-tag {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .agent-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #f0f0f0;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
        }

        .voice-indicator {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .voice-indicator.active {
            opacity: 1;
            animation: voicePulse 1.5s ease-in-out infinite;
        }

        @keyframes voicePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }

        .voice-indicator svg {
            width: 28px;
            height: 28px;
            fill: #667eea;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.4s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            color: #667eea;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5em;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .modal-close:hover {
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 30px;
        }

        .task-section, .chat-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .task-list {
            list-style: none;
        }

        .task-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .add-task-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: transform 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .add-task-btn:hover {
            transform: scale(1.05);
        }

        .task-input-container {
            display: none;
            margin-top: 15px;
            animation: slideDown 0.3s ease;
        }

        .task-input-container.active {
            display: block;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .task-input-box {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .task-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            font-family: inherit;
        }

        .task-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .voice-input-btn {
            background: #f0f0f0;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s ease;
        }

        .voice-input-btn:hover {
            background: #e0e0e0;
        }

        .voice-input-btn.recording {
            background: #ff4444;
            animation: pulse 1s ease-in-out infinite;
        }

        .submit-task-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
        }

        .chat-messages {
            max-height: 300px;
            overflow-y: auto;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .chat-message {
            margin-bottom: 15px;
            padding: 12px;
            border-radius: 10px;
            animation: fadeIn 0.3s ease;
        }

        .chat-message.user {
            background: #667eea;
            color: white;
            margin-left: 50px;
        }

        .chat-message.agent {
            background: white;
            color: #333;
            margin-right: 50px;
        }

        .chat-input-box {
            display: flex;
            gap: 10px;
        }

        .loading-indicator {
            display: none;
            text-align: center;
            padding: 20px;
            color: #667eea;
        }

        .loading-indicator.active {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Authentication Check -->
    <script>
        // Redirect to login if not authenticated
        if (!localStorage.getItem('isAuthenticated')) {
            window.location.href = 'index.html';
        }
    </script>

    <div class="container">
        
            <button class="btn btn-back" onclick="window.location.href='dashboard.html'" style="
                position: absolute;
                top: 20px;
                left: 20px;
                background: rgba(255, 255, 255, 0.1);
                color: white;
                border: 1px solid rgba(255, 255, 255, 0.2);
                padding: 10px 20px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 14px;
                transition: all 0.3s ease;
            " onmouseover="this.style.background='rgba(255, 255, 255, 0.2)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'">
                ‚Üê Back to Dashboard
            </button>
<div class="header">
            <h1>‚ú® Marketing Empire - AI Agent Team</h1>
            <p>Your Elite Squad of 5 AI Marketing Professionals</p>
        </div>

        <div class="agents-grid" id="agentsGrid">
            <!-- Agent cards will be dynamically inserted here -->
        </div>
    </div>

    <!-- Modal -->
    <div class="modal" id="agentModal">
        <div class="modal-content">
            <div class="modal-header">
                <button class="modal-close" onclick="closeModal()">√ó</button>
                <h2 id="modalAgentName"></h2>
                <p id="modalAgentRole"></p>
            </div>
            <div class="modal-body">
                <div class="loading-indicator" id="loadingIndicator">
                    <div class="spinner"></div>
                    <p>Agent is speaking...</p>
                </div>

                <div class="task-section">
                    <div class="section-title">
                        <span>üìã</span>
                        <span>Current Tasks</span>
                    </div>
                    <ul class="task-list" id="taskList"></ul>
                    <button class="add-task-btn" onclick="toggleTaskInput()">
                        <span>‚ûï</span>
                        <span>Add New Task</span>
                    </button>
                    <div class="task-input-container" id="taskInputContainer">
                        <div class="task-input-box">
                            <input type="text" class="task-input" id="taskInput" placeholder="Describe the task in natural language...">
                            <button class="voice-input-btn" id="voiceInputBtn" onclick="toggleVoiceInput()">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                                    <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                                </svg>
                            </button>
                        </div>
                        <button class="submit-task-btn" onclick="submitTask()">Submit Task</button>
                    </div>
                </div>

                <div class="chat-section">
                    <div class="section-title">
                        <span>üí¨</span>
                        <span>Chat with Agent</span>
                    </div>
                    <div class="chat-messages" id="chatMessages">
                        <p style="text-align: center; color: #999; padding: 20px;">Start a conversation with your agent!</p>
                    </div>
                    <div class="chat-input-box">
                        <input type="text" class="task-input" id="chatInput" placeholder="Ask about tasks, efficiency, revenue optimization...">
                        <button class="voice-input-btn" onclick="toggleChatVoice()">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                                <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                            </svg>
                        </button>
                        <button class="submit-task-btn" onclick="sendChatMessage()">Send</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let agentsRendered = false;
        // Agent data - will be populated from backend
        const AGENTS_DATA = [{"id": "agent_001", "name": "Sophia Chen", "gender": "female", "role": "Content Writer & Social Media Strategist", "personality": "Creative, witty, and data-driven. Sophia turns insights into viral content with a strategic edge.", "skills": ["Social Media Copywriting", "Reddit Engagement", "Viral Content Strategy", "A/B Testing", "Community Building"], "responsibilities": ["Create engaging Reddit posts", "Monitor social media trends", "Craft compelling product narratives", "Optimize post timing and engagement"], "voice": {"name": "Sarah - Mature, Reassuring, Confident", "voice_id": "EXAVITQu4vr4xnSDxMaL", "description": "Young adult woman with a confident and warm, mature quality and a reassuring, professional tone.", "descriptive": "professional"}, "avatar_url": "https://temp.4d4f16c61d89ec64e760039c4ec50717.r2.cloudflarestorage.com/254733/dynamic-module-load/GENERATE_IMAGE/response/587803f0123bbfd17274384f0b2a05bd?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=e22d99e14b94fe5f16acc83614a762b5%2F20260221%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20260221T104545Z&X-Amz-Expires=3600&X-Amz-Signature=47bd43133ce32be69f50629b75f5f484d4921bfb2a9a840a825ce47c2190e501&X-Amz-SignedHeaders=host", "quick_responses": ["Hey there! I'm Sophia, your Content Writer. Ready to create some viral magic today!", "Perfect timing! I've got some fresh content ideas brewing.", "Let's make some noise on Reddit! What's our strategy today?"], "current_tasks": ["Create 3 Reddit posts for r/SkincareAddiction highlighting luxury dupes", "Analyze top-performing Reddit posts from last week", "Draft social media copy for Instagram promotion"], "task_history": [], "chat_memory": [], "stats": {"tasks_completed": 0, "success_rate": 0, "total_revenue_generated": 0, "efficiency_score": 0}}, {"id": "agent_002", "name": "Marcus Rivera", "gender": "male", "role": "Research & Competitive Intelligence Lead", "personality": "Analytical, thorough, and insightful. Marcus uncovers market opportunities others miss.", "skills": ["Competitive Analysis", "Market Research", "Data Mining", "Trend Forecasting", "Consumer Insights"], "responsibilities": ["Track competitor strategies", "Identify trending products", "Analyze market gaps", "Generate weekly research reports"], "voice": {"name": "Roger - Laid-Back, Casual, Resonant", "voice_id": "CwhRBWXzGAHq8TQ4Fs17", "description": "Easy going and perfect for casual conversations.", "descriptive": "classy"}, "avatar_url": "https://temp.4d4f16c61d89ec64e760039c4ec50717.r2.cloudflarestorage.com/254733/dynamic-module-load/GENERATE_IMAGE/response/34b0f0e3cb87ebf851ab70fd0a4d3819?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=e22d99e14b94fe5f16acc83614a762b5%2F20260221%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20260221T104544Z&X-Amz-Expires=3600&X-Amz-Signature=e2e11a37fe4e5f2d3e504b649a8e7fe28a1e4e6342ae93397ea361d63505b44a&X-Amz-SignedHeaders=host", "quick_responses": ["Marcus here. I've been analyzing the competition \u2013 got some interesting insights for you.", "Data doesn't lie. Let me show you what I've discovered.", "Ready to dive into the research? I've found some golden opportunities."], "current_tasks": ["Research trending skincare products on Amazon for March 2026", "Analyze competitor Reddit strategies in beauty niche", "Generate weekly competitive intelligence report"], "task_history": [], "chat_memory": [], "stats": {"tasks_completed": 0, "success_rate": 0, "total_revenue_generated": 0, "efficiency_score": 0}}, {"id": "agent_003", "name": "Isabella Monroe", "gender": "female", "role": "Email Marketing & Automation Specialist", "personality": "Persuasive, empathetic, and conversion-focused. Bella crafts emails that people actually want to read.", "skills": ["Email Copywriting", "Automation Workflows", "Segmentation Strategy", "A/B Testing", "Conversion Optimization"], "responsibilities": ["Design email sequences", "Optimize open and click rates", "Manage Brevo automations", "Build subscriber relationships"], "voice": {"name": "Laura - Enthusiast, Quirky Attitude", "voice_id": "FGY2WhTYpPnrIDTdsKH5", "description": "This young adult female voice delivers sunny enthusiasm with a quirky attitude.", "descriptive": "sassy"}, "avatar_url": "https://temp.4d4f16c61d89ec64e760039c4ec50717.r2.cloudflarestorage.com/254733/dynamic-module-load/GENERATE_IMAGE/response/3e71c979b5e750820d087e61569ff486?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=e22d99e14b94fe5f16acc83614a762b5%2F20260221%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20260221T104543Z&X-Amz-Expires=3600&X-Amz-Signature=7b972904c17da60e5c83b7eb69d2743bfee747909930c74bccc53741a38593af&X-Amz-SignedHeaders=host", "quick_responses": ["Isabella at your service! Let's boost those email conversions!", "Hey! I've been optimizing our email sequences \u2013 the numbers are looking great!", "Time to nurture those leads into loyal customers. What do you need?"], "current_tasks": ["Optimize email sequence #2 subject lines for better open rates", "Create abandoned cart recovery email template", "Segment subscriber list by engagement level"], "task_history": [], "chat_memory": [], "stats": {"tasks_completed": 0, "success_rate": 0, "total_revenue_generated": 0, "efficiency_score": 0}}, {"id": "agent_004", "name": "Ava Thompson", "gender": "female", "role": "Product Analysis & Revenue Optimization", "personality": "Detail-oriented, strategic, and ROI-obsessed. Ava finds the hidden money in every metric.", "skills": ["Product Selection", "Commission Analysis", "Revenue Forecasting", "Performance Metrics", "Profitability Optimization"], "responsibilities": ["Analyze product performance", "Identify high-converting products", "Track revenue metrics", "Optimize product mix"], "voice": {"name": "Alice - Clear, Engaging Educator", "voice_id": "Xb7hH8MSUJpSbSDYk0k2", "description": "Clear and engaging, friendly woman with a British accent suitable for e-learning.", "descriptive": "professional"}, "avatar_url": "https://temp.4d4f16c61d89ec64e760039c4ec50717.r2.cloudflarestorage.com/254733/dynamic-module-load/GENERATE_IMAGE/response/d11df58d07f0b30a0b36725436498ece?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=e22d99e14b94fe5f16acc83614a762b5%2F20260221%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20260221T104545Z&X-Amz-Expires=3600&X-Amz-Signature=82a995e7070847fe9b4ce006980937a6d67cfe224b25baa5a860cd0dedc04a4e&X-Amz-SignedHeaders=host", "quick_responses": ["Ava here! I've been crunching the numbers on product performance.", "Let's talk ROI! I've identified some high-potential products for you.", "Revenue optimization is my jam. Ready to see the analytics?"], "current_tasks": ["Analyze product performance for CeraVe Eye Repair Cream", "Identify products with highest conversion rates", "Calculate ROI for each revenue stream"], "task_history": [], "chat_memory": [], "stats": {"tasks_completed": 0, "success_rate": 0, "total_revenue_generated": 0, "efficiency_score": 0}}, {"id": "agent_005", "name": "Daniel Cross", "gender": "male", "role": "Strategic Planning & Campaign Architect", "personality": "Visionary, methodical, and results-driven. Daniel orchestrates campaigns that scale.", "skills": ["Campaign Strategy", "Budget Planning", "Channel Optimization", "Growth Hacking", "Performance Forecasting"], "responsibilities": ["Design marketing campaigns", "Allocate resources strategically", "Optimize channel mix", "Forecast revenue targets"], "voice": {"name": "Charlie - Deep, Confident, Energetic", "voice_id": "IKne3meq5aSn9XLyUdCD", "description": "A young Australian male with a confident and energetic voice.", "descriptive": "hyped"}, "avatar_url": "https://temp.4d4f16c61d89ec64e760039c4ec50717.r2.cloudflarestorage.com/254733/dynamic-module-load/GENERATE_IMAGE/response/bbaeb4de24b44a3970c7352dd6ca94b6?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=e22d99e14b94fe5f16acc83614a762b5%2F20260221%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20260221T104601Z&X-Amz-Expires=3600&X-Amz-Signature=b6b23de788324bead6b51bc29324296dd17cbffae72ee3a97327c83f7ec5c0a4&X-Amz-SignedHeaders=host", "quick_responses": ["Daniel Cross, Strategic Planning. Let's architect your next big campaign!", "Strategy time! I've mapped out some powerful growth opportunities.", "Ready to scale? I've got the blueprint for your success."], "current_tasks": ["Design Q2 2026 marketing campaign strategy", "Allocate $500 monthly budget across channels", "Forecast revenue targets for next 90 days"], "task_history": [], "chat_memory": [], "stats": {"tasks_completed": 0, "success_rate": 0, "total_revenue_generated": 0, "efficiency_score": 0}}];

        // ElevenLabs API configuration
        const ELEVENLABS_API_KEY = '37b2d7684ea1b8f85b21cf63b5895567';
        const ELEVENLABS_MODEL = 'eleven_flash_v2_5';  // Fast, low latency

        // Current selected agent
        let currentAgent = null;

        // Speech recognition (voice input)
        let recognition = null;
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';
        }

        // Initialize the dashboard
        function init() {
            renderAgentCards();
        }

        // Render agent cards
        function renderAgentCards() {
            const grid = document.getElementById('agentsGrid');
            grid.innerHTML = '';

            AGENTS_DATA.forEach(agent => {
                const card = document.createElement('div');
                card.className = 'agent-card';
                card.onclick = () => openAgentModal(agent);

                const skillsHTML = agent.skills.slice(0, 3).map(skill => 
                    `<span class="skill-tag">${skill}</span>`
                ).join('');

                card.innerHTML = `
                    <div class="voice-indicator" id="voice-${agent.id}">
                        <svg viewBox="0 0 24 24">
                            <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
                        </svg>
                    </div>
                    <img src="${agent.avatar_url}" alt="${agent.name}" class="agent-avatar" onerror="this.src='https://via.placeholder.com/400x300/667eea/ffffff?text=${encodeURIComponent(agent.name)}'">
                    <div class="agent-info">
                        <h2 class="agent-name">${agent.name}</h2>
                        <p class="agent-role">${agent.role}</p>
                        <p class="agent-personality">${agent.personality}</p>
                        <div class="agent-skills">${skillsHTML}</div>
                        <div class="agent-stats">
                            <div class="stat-item">
                                <div class="stat-value">${agent.stats.tasks_completed}</div>
                                <div class="stat-label">Tasks Done</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${agent.stats.success_rate}%</div>
                                <div class="stat-label">Success Rate</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">$${agent.stats.total_revenue_generated}</div>
                                <div class="stat-label">Revenue</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${agent.stats.efficiency_score}%</div>
                                <div class="stat-label">Efficiency</div>
                            </div>
                        </div>
                    </div>
                `;

                grid.appendChild(card);
            });
        }

        // Open agent modal with voice greeting
        async 

        // Voice function for agent speech
        async function playAgentVoice(agentId) {
            try {
                const agent = AGENTS_DATA.find(a => a.id === agentId);
                if (!agent) {
                    console.error('Agent not found:', agentId);
                    return;
                }

                const voiceBtn = document.querySelector('.voice-btn');
                if (voiceBtn) {
                    voiceBtn.disabled = true;
                    voiceBtn.innerHTML = 'üîä Playing...';
                }

                // Create introduction text
                const intro = `Hi! I'm ${agent.name}, your ${agent.role}. I'm currently working on ${agent.skills[0]} and ${agent.skills[1]}. How can I help you optimize your marketing today?`;

                // ElevenLabs API configuration
                const apiKey = '37b2d7684ea1b8f85b21cf63b5895567';
                const voiceId = agent.voice_id || 'EXAVITQu4vr4xnSDxMaL';

                const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${voiceId}`, {
                    method: 'POST',
                    headers: {
                        'Accept': 'audio/mpeg',
                        'Content-Type': 'application/json',
                        'xi-api-key': apiKey
                    },
                    body: JSON.stringify({
                        text: intro,
                        model_id: 'eleven_flash_v2_5',
                        voice_settings: {
                            stability: 0.5,
                            similarity_boost: 0.75,
                            style: 0.5,
                            use_speaker_boost: true
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const audioBlob = await response.blob();
                const audioUrl = URL.createObjectURL(audioBlob);
                const audio = new Audio(audioUrl);

                audio.onended = () => {
                    if (voiceBtn) {
                        voiceBtn.disabled = false;
                        voiceBtn.innerHTML = 'üé§ Hear Voice Update';
                    }
                    URL.revokeObjectURL(audioUrl);
                };

                audio.onerror = () => {
                    console.error('Audio playback error');
                    if (voiceBtn) {
                        voiceBtn.disabled = false;
                        voiceBtn.innerHTML = 'üé§ Hear Voice Update';
                    }
                };

                await audio.play();

            } catch (error) {
                console.error('Voice error:', error);
                const voiceBtn = document.querySelector('.voice-btn');
                if (voiceBtn) {
                    voiceBtn.disabled = false;
                    voiceBtn.innerHTML = 'üé§ Hear Voice Update';
                }
                alert('Voice playback failed. Please check your internet connection.');
            }
        }

function openAgentModal(agent) {
            currentAgent = agent;
            const modal = document.getElementById('agentModal');
            const loading = document.getElementById('loadingIndicator');

            // Update modal content
            document.getElementById('modalAgentName').textContent = agent.name;
            document.getElementById('modalAgentRole').textContent = agent.role;

            // Show modal
            modal.classList.add('active');

            // Show loading and play voice greeting
            loading.classList.add('active');
            const card = document.querySelector(`.agent-card:nth-child(${AGENTS_DATA.indexOf(agent) + 1})`);
            card.classList.add('speaking');

            // Play cached quick response first for instant feedback
            await playCachedGreeting(agent);

            // Load and speak full task agenda in parallel
            await speakTaskAgenda(agent);

            // Hide loading
            loading.classList.remove('active');
            card.classList.remove('speaking');

            // Render tasks
            renderTasks(agent);
            renderChatHistory(agent);
        }

        // Play cached greeting (instant response)
        async function playCachedGreeting(agent) {
            const voiceIndicator = document.getElementById(`voice-${agent.id}`);
            voiceIndicator.classList.add('active');

            // Use first quick response
            const greetingText = agent.quick_responses[0];

            try {
                // Generate and play audio
                const audioUrl = await generateSpeech(greetingText, agent.voice.voice_id);
                const audio = new Audio(audioUrl);

                await audio.play();

                // Wait for audio to finish
                await new Promise(resolve => {
                    audio.onended = resolve;
                });
            } catch (error) {
                console.error('Error playing greeting:', error);
            } finally {
                voiceIndicator.classList.remove('active');
            }
        }

        // Speak task agenda
        async function speakTaskAgenda(agent) {
            const taskCount = agent.current_tasks.length;
            const agendaText = `I currently have ${taskCount} active tasks. ${taskCount > 0 ? 'Let me tell you about them. ' + agent.current_tasks[0] : 'I\'m ready for new assignments!'}`;

            try {
                const audioUrl = await generateSpeech(agendaText, agent.voice.voice_id);
                const audio = new Audio(audioUrl);
                await audio.play();
                await new Promise(resolve => { audio.onended = resolve; });
            } catch (error) {
                console.error('Error speaking agenda:', error);
            }
        }

        // Generate speech using ElevenLabs API
        async function generateSpeech(text, voiceId) {
            const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${voiceId}`, {
                method: 'POST',
                headers: {
                    'Accept': 'audio/mpeg',
                    'xi-api-key': ELEVENLABS_API_KEY,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    text: text,
                    model_id: ELEVENLABS_MODEL,
                    voice_settings: {
                        stability: 0.5,
                        similarity_boost: 0.75
                    }
                })
            });

            if (!response.ok) {
                throw new Error(`ElevenLabs API error: ${response.status}`);
            }

            const audioBlob = await response.blob();
            return URL.createObjectURL(audioBlob);
        }

        // Render tasks
        function renderTasks(agent) {
            const taskList = document.getElementById('taskList');
            taskList.innerHTML = '';

            if (agent.current_tasks.length === 0) {
                taskList.innerHTML = '<li class="task-item">No active tasks. Add one below!</li>';
                return;
            }

            agent.current_tasks.forEach((task, index) => {
                const li = document.createElement('li');
                li.className = 'task-item';
                li.textContent = task;
                taskList.appendChild(li);
            });
        }

        // Render chat history
        function renderChatHistory(agent) {
            const chatMessages = document.getElementById('chatMessages');

            if (agent.chat_memory.length === 0) {
                chatMessages.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">Start a conversation with your agent!</p>';
                return;
            }

            chatMessages.innerHTML = '';
            agent.chat_memory.forEach(msg => {
                const div = document.createElement('div');
                div.className = `chat-message ${msg.role}`;
                div.textContent = msg.content;
                chatMessages.appendChild(div);
            });
        }

        // Toggle task input
        function toggleTaskInput() {
            const container = document.getElementById('taskInputContainer');
            container.classList.toggle('active');
        }

        // Submit task
        async function submitTask() {
            const input = document.getElementById('taskInput');
            const taskText = input.value.trim();

            if (!taskText || !currentAgent) return;

            // Add task to agent
            currentAgent.current_tasks.push(taskText);

            // Re-render tasks
            renderTasks(currentAgent);

            // Clear input
            input.value = '';

            // Hide input container
            document.getElementById('taskInputContainer').classList.remove('active');

            // Agent speaks acknowledgment
            const ackText = `Got it! I'll work on: ${taskText}`;
            try {
                const audioUrl = await generateSpeech(ackText, currentAgent.voice.voice_id);
                const audio = new Audio(audioUrl);
                await audio.play();
            } catch (error) {
                console.error('Error playing acknowledgment:', error);
            }
        }

        // Send chat message
        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const messageText = input.value.trim();

            if (!messageText || !currentAgent) return;

            // Add user message to chat memory
            currentAgent.chat_memory.push({
                role: 'user',
                content: messageText
            });

            // Simple AI response (in production, this would call your LLM)
            const agentResponse = generateAgentResponse(messageText, currentAgent);
            currentAgent.chat_memory.push({
                role: 'agent',
                content: agentResponse
            });

            // Re-render chat
            renderChatHistory(currentAgent);

            // Clear input
            input.value = '';

            // Scroll to bottom
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Agent speaks response
            try {
                const audioUrl = await generateSpeech(agentResponse, currentAgent.voice.voice_id);
                const audio = new Audio(audioUrl);
                await audio.play();
            } catch (error) {
                console.error('Error playing response:', error);
            }
        }

        // Generate agent response (simplified - in production, use LLM)
        function generateAgentResponse(userMessage, agent) {
            const lowerMessage = userMessage.toLowerCase();

            if (lowerMessage.includes('task') || lowerMessage.includes('working on')) {
                return `I'm currently working on ${agent.current_tasks.length} tasks. My top priority right now is: ${agent.current_tasks[0] || 'waiting for new assignments'}.`;
            } else if (lowerMessage.includes('revenue') || lowerMessage.includes('money') || lowerMessage.includes('earn')) {
                return `Great question! Based on our current strategy, I've contributed to $${agent.stats.total_revenue_generated} in revenue. I'm constantly optimizing to increase that number!`;
            } else if (lowerMessage.includes('efficiency') || lowerMessage.includes('improve') || lowerMessage.includes('better')) {
                return `My current efficiency score is ${agent.stats.efficiency_score}%. I'm always learning and adapting. Give me more tasks and I'll show you what I can do!`;
            } else {
                return `I understand you're asking about "${userMessage}". As your ${agent.role}, I'm here to help optimize our marketing strategy. What specific area would you like to focus on?`;
            }
        }

        // Toggle voice input for tasks
        function toggleVoiceInput() {
            if (!recognition) {
                alert('Speech recognition is not supported in your browser.');
                return;
            }

            const btn = document.getElementById('voiceInputBtn');

            if (btn.classList.contains('recording')) {
                recognition.stop();
                btn.classList.remove('recording');
            } else {
                btn.classList.add('recording');
                recognition.start();

                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('taskInput').value = transcript;
                    btn.classList.remove('recording');
                };

                recognition.onerror = () => {
                    btn.classList.remove('recording');
                };
            }
        }

        // Toggle voice input for chat
        function toggleChatVoice() {
            if (!recognition) {
                alert('Speech recognition is not supported in your browser.');
                return;
            }

            recognition.start();

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                document.getElementById('chatInput').value = transcript;
            };
        }

        // Close modal
        function closeModal() {
            document.getElementById('agentModal').classList.remove('active');
            document.getElementById('taskInputContainer').classList.remove('active');
            currentAgent = null;
        }

        // Close modal on backdrop click
        document.getElementById('agentModal').addEventListener('click', (e) => {
            if (e.target.id === 'agentModal') {
                closeModal();
            }
        });

        // Enter key handlers
        document.getElementById('taskInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') submitTask();
        });

        document.getElementById('chatInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendChatMessage();
        });

        // Initialize on load
        window.onload = init;
    </script>
</body>
</html>