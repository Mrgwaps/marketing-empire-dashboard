<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marketing Empire Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeInDown 0.8s ease;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .refresh-indicator {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .refresh-indicator.loading {
            animation: pulse 1.5s infinite;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            animation: fadeInUp 0.8s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .metric {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .metric.revenue {
            color: #4ade80;
        }

        .metric.subs {
            color: #60a5fa;
        }

        .metric.posts {
            color: #fbbf24;
        }

        .sub-metric {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 5px;
        }

        .income-stream {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .income-stream:last-child {
            border-bottom: none;
        }

        .stream-name {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stream-icon {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }

        .stream-icon.amazon { background: #ff9900; }
        .stream-icon.payhip { background: #5469d4; }
        .stream-icon.leads { background: #10b981; }
        .stream-icon.youtube { background: #ff0000; }
        .stream-icon.agentmail { background: #8b5cf6; }

        .stream-amount {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .progress-bar {
            width: 100%;
            height: 25px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ade80, #10b981);
            transition: width 1s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.active {
            background: #4ade80;
            box-shadow: 0 0 8px #4ade80;
        }

        .status-indicator.inactive {
            background: #f87171;
        }

        .system-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .system-row:last-child {
            border-bottom: none;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.6;
            }
        }

        .error-message {
            background: rgba(248, 113, 113, 0.2);
            border: 1px solid #f87171;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .metric {
                font-size: 2rem;
            }

            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ú® Marketing Empire Dashboard</h1>
            <p>Real-time tracking across 5+ income streams</p>
            <div class="refresh-indicator" id="refreshIndicator">
                <span id="lastUpdate">Loading...</span>
            </div>
        </div>

        <div class="grid">
            <!-- Total Revenue Card -->
            <div class="card">
                <div class="card-title">üí∞ Total Revenue</div>
                <div class="metric revenue" id="totalRevenue">$0.00</div>
                <div class="sub-metric">Next milestone: First $1 earned</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="revenueProgress" style="width: 0%">0%</div>
                </div>
            </div>

            <!-- Email Subscribers Card -->
            <div class="card">
                <div class="card-title">üìß Email Subscribers</div>
                <div class="metric subs" id="totalSubs">0</div>
                <div class="sub-metric">Next milestone: 10 subscribers</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="subsProgress" style="width: 0%">0%</div>
                </div>
            </div>

            <!-- Content Published Card -->
            <div class="card">
                <div class="card-title">üìù Content Published</div>
                <div class="metric posts" id="totalPosts">0</div>
                <div class="sub-metric">Reddit posts tracked</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="postsProgress" style="width: 0%">0%</div>
                </div>
            </div>
        </div>

        <div class="grid">
            <!-- Revenue Breakdown Card -->
            <div class="card">
                <div class="card-title">üíµ Revenue by Stream</div>
                <div class="income-stream">
                    <div class="stream-name">
                        <span class="stream-icon amazon"></span>
                        Amazon Associates
                    </div>
                    <div class="stream-amount" id="amazonRevenue">$0.00</div>
                </div>
                <div class="income-stream">
                    <div class="stream-name">
                        <span class="stream-icon payhip"></span>
                        Payhip Digital Products
                    </div>
                    <div class="stream-amount" id="payhipRevenue">$0.00</div>
                </div>
                <div class="income-stream">
                    <div class="stream-name">
                        <span class="stream-icon leads"></span>
                        Lead Generation
                    </div>
                    <div class="stream-amount" id="leadsRevenue">$0.00</div>
                </div>
                <div class="income-stream">
                    <div class="stream-name">
                        <span class="stream-icon youtube"></span>
                        YouTube (KIE AI)
                    </div>
                    <div class="stream-amount" id="youtubeRevenue">$0.00</div>
                </div>
                <div class="income-stream">
                    <div class="stream-name">
                        <span class="stream-icon agentmail"></span>
                        AgentMail Services
                    </div>
                    <div class="stream-amount" id="agentmailRevenue">$0.00</div>
                </div>
            </div>

            <!-- System Status Card -->
            <div class="card">
                <div class="card-title">üîß System Status</div>
                <div class="system-row">
                    <div>
                        <span class="status-indicator active"></span>
                        Airtable Dashboard
                    </div>
                    <span>‚úì Active</span>
                </div>
                <div class="system-row">
                    <div>
                        <span class="status-indicator active"></span>
                        Reddit Tracking
                    </div>
                    <span>‚úì Daily</span>
                </div>
                <div class="system-row">
                    <div>
                        <span class="status-indicator active"></span>
                        Brevo Email Sync
                    </div>
                    <span>‚úì Weekly</span>
                </div>
                <div class="system-row">
                    <div>
                        <span class="status-indicator active"></span>
                        Milestone Alerts
                    </div>
                    <span>‚úì Every 30 min</span>
                </div>
                <div class="system-row">
                    <div>
                        <span class="status-indicator active"></span>
                        Competitive Research
                    </div>
                    <span>‚úì Weekly</span>
                </div>
            </div>
        </div>

        <div class="grid">
            <!-- Revenue Trend Chart -->
            <div class="card">
                <div class="card-title">üìà Revenue Trend (30 Days)</div>
                <div class="chart-container">
                    <canvas id="revenueChart"></canvas>
                </div>
            </div>

            <!-- Traffic Chart -->
            <div class="card">
                <div class="card-title">üëÅÔ∏è Traffic & Engagement</div>
                <div class="chart-container">
                    <canvas id="trafficChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const AIRTABLE_BASE_ID = 'appl6ToZSGjS6wU0K';
        const AIRTABLE_PAT = 'YOUR_AIRTABLE_PAT_HERE'; // User needs to add their Personal Access Token
        const REFRESH_INTERVAL = 300000; // 5 minutes

        // Chart configurations
        let revenueChart, trafficChart;

        // Initialize charts
        function initCharts() {
            const commonOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#fff',
                            font: { size: 12 }
                        }
                    }
                },
                scales: {
                    y: {
                        ticks: { color: '#fff' },
                        grid: { color: 'rgba(255, 255, 255, 0.1)' }
                    },
                    x: {
                        ticks: { color: '#fff' },
                        grid: { color: 'rgba(255, 255, 255, 0.1)' }
                    }
                }
            };

            // Revenue Chart
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            revenueChart = new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: ['Day 1', 'Day 7', 'Day 14', 'Day 21', 'Day 30'],
                    datasets: [{
                        label: 'Total Revenue',
                        data: [0, 0, 0, 0, 0],
                        borderColor: '#4ade80',
                        backgroundColor: 'rgba(74, 222, 128, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: commonOptions
            });

            // Traffic Chart
            const trafficCtx = document.getElementById('trafficChart').getContext('2d');
            trafficChart = new Chart(trafficCtx, {
                type: 'bar',
                data: {
                    labels: ['Reddit', 'Email', 'YouTube', 'Direct'],
                    datasets: [{
                        label: 'Engagement',
                        data: [0, 0, 0, 0],
                        backgroundColor: [
                            'rgba(255, 153, 0, 0.8)',
                            'rgba(96, 165, 250, 0.8)',
                            'rgba(255, 0, 0, 0.8)',
                            'rgba(139, 92, 246, 0.8)'
                        ]
                    }]
                },
                options: commonOptions
            });
        }

        // Fetch data from Airtable
        async function fetchAirtableData() {
            const indicator = document.getElementById('refreshIndicator');
            indicator.classList.add('loading');

            try {
                // Check if PAT is configured
                if (AIRTABLE_PAT === 'YOUR_AIRTABLE_PAT_HERE') {
                    console.log('Airtable PAT not configured. Using demo data.');
                    updateDashboard(getDemoData());
                    return;
                }

                // Fetch data from all tables
                const headers = {
                    'Authorization': `Bearer ${AIRTABLE_PAT}`,
                    'Content-Type': 'application/json'
                };

                const [emailMetrics, productPerformance, redditPerformance] = await Promise.all([
                    fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/Email%20Metrics`, { headers }).then(r => r.json()),
                    fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/Product%20Performance`, { headers }).then(r => r.json()),
                    fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/Reddit%20Performance`, { headers }).then(r => r.json())
                ]);

                // Process and update dashboard
                const data = processAirtableData(emailMetrics, productPerformance, redditPerformance);
                updateDashboard(data);

            } catch (error) {
                console.error('Error fetching data:', error);
                updateDashboard(getDemoData());
            } finally {
                indicator.classList.remove('loading');
                document.getElementById('lastUpdate').textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
            }
        }

        // Process Airtable data
        function processAirtableData(emailMetrics, productPerformance, redditPerformance) {
            // Extract latest metrics
            const latestEmail = emailMetrics.records[0]?.fields || {};
            const products = productPerformance.records || [];
            const posts = redditPerformance.records || [];

            // Calculate totals
            const totalRevenue = products.reduce((sum, p) => sum + (p.fields['Revenue'] || 0), 0);
            const totalSubs = latestEmail['Total Subscribers'] || 0;
            const totalPosts = posts.length;

            // Revenue by stream (from products table with Income Stream field)
            const streams = {
                amazon: products.filter(p => p.fields['Income Stream'] === 'Amazon Associates').reduce((s, p) => s + (p.fields['Revenue'] || 0), 0),
                payhip: products.filter(p => p.fields['Income Stream'] === 'Payhip').reduce((s, p) => s + (p.fields['Revenue'] || 0), 0),
                leads: products.filter(p => p.fields['Income Stream'] === 'Lead Gen').reduce((s, p) => s + (p.fields['Revenue'] || 0), 0),
                youtube: products.filter(p => p.fields['Income Stream'] === 'YouTube').reduce((s, p) => s + (p.fields['Revenue'] || 0), 0),
                agentmail: products.filter(p => p.fields['Income Stream'] === 'AgentMail').reduce((s, p) => s + (p.fields['Revenue'] || 0), 0)
            };

            return {
                totalRevenue,
                totalSubs,
                totalPosts,
                streams,
                posts: posts.map(p => ({
                    upvotes: p.fields['Upvotes'] || 0,
                    comments: p.fields['Comments'] || 0
                }))
            };
        }

        // Demo data for when Airtable is not connected
        function getDemoData() {
            return {
                totalRevenue: 0,
                totalSubs: 0,
                totalPosts: 0,
                streams: {
                    amazon: 0,
                    payhip: 0,
                    leads: 0,
                    youtube: 0,
                    agentmail: 0
                },
                posts: []
            };
        }

        // Update dashboard UI
        function updateDashboard(data) {
            // Update main metrics
            document.getElementById('totalRevenue').textContent = `$${data.totalRevenue.toFixed(2)}`;
            document.getElementById('totalSubs').textContent = data.totalSubs;
            document.getElementById('totalPosts').textContent = data.totalPosts;

            // Update progress bars
            const revenueProgress = Math.min((data.totalRevenue / 1) * 100, 100);
            document.getElementById('revenueProgress').style.width = `${revenueProgress}%`;
            document.getElementById('revenueProgress').textContent = `${revenueProgress.toFixed(0)}%`;

            const subsProgress = Math.min((data.totalSubs / 10) * 100, 100);
            document.getElementById('subsProgress').style.width = `${subsProgress}%`;
            document.getElementById('subsProgress').textContent = `${subsProgress.toFixed(0)}%`;

            const postsProgress = Math.min((data.totalPosts / 30) * 100, 100);
            document.getElementById('postsProgress').style.width = `${postsProgress}%`;
            document.getElementById('postsProgress').textContent = `${postsProgress.toFixed(0)}%`;

            // Update revenue streams
            document.getElementById('amazonRevenue').textContent = `$${data.streams.amazon.toFixed(2)}`;
            document.getElementById('payhipRevenue').textContent = `$${data.streams.payhip.toFixed(2)}`;
            document.getElementById('leadsRevenue').textContent = `$${data.streams.leads.toFixed(2)}`;
            document.getElementById('youtubeRevenue').textContent = `$${data.streams.youtube.toFixed(2)}`;
            document.getElementById('agentmailRevenue').textContent = `$${data.streams.agentmail.toFixed(2)}`;

            // Update charts (simplified for demo - would use real historical data)
            revenueChart.data.datasets[0].data = [0, 0, 0, 0, data.totalRevenue];
            revenueChart.update();

            const totalEngagement = data.posts.reduce((sum, p) => sum + p.upvotes + p.comments, 0);
            trafficChart.data.datasets[0].data = [totalEngagement, data.totalSubs, 0, 0];
            trafficChart.update();
        }

        // Initialize
        initCharts();
        fetchAirtableData();

        // Auto-refresh every 5 minutes
        setInterval(fetchAirtableData, REFRESH_INTERVAL);
    </script>
</body>
</html>