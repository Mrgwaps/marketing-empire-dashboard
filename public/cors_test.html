<!DOCTYPE html>
<html>
<head>
    <title>CORS Test - Marketing Empire Dashboard</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 { color: #667eea; }
        #status {
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            font-weight: 600;
            background: #fff;
            border: 2px solid #ddd;
        }
        #result {
            padding: 15px;
            border-radius: 8px;
            background: white;
            border: 2px solid #ddd;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <h1>üß™ Testing Supabase CORS Configuration</h1>
    <div id="status">Initializing test...</div>
    <div id="result"></div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';
        
        const supabaseUrl = 'https://wxwfrhvqgfpodwzjwlil.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind4d2ZyaHZxZ2Zwb2R3emp3bGlsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA3MTEyMzYsImV4cCI6MjA1NjI4NzIzNn0.CK7u5J0ZVQNmFP2kYY-MKjFCPZDRwkzgwfpEw3_oMU4';
        
        const statusDiv = document.getElementById('status');
        const resultDiv = document.getElementById('result');
        
        try {
            statusDiv.textContent = '‚è≥ Creating Supabase client...';
            statusDiv.style.borderColor = '#ffa500';
            const supabase = createClient(supabaseUrl, supabaseKey);
            
            statusDiv.textContent = '‚è≥ Testing connection to Supabase Auth API...';
            
            // Try to get current session (this will test CORS)
            const { data, error } = await supabase.auth.getSession();
            
            if (error) {
                if (error.message && error.message.includes('CORS')) {
                    statusDiv.textContent = '‚ùå CORS ERROR DETECTED';
                    statusDiv.style.borderColor = '#f00';
                    statusDiv.style.background = '#fee';
                    resultDiv.innerHTML = `<pre style="color: red;">CORS Error: ${error.message}\n\nFIX: Go to Supabase Dashboard > Authentication > URL Configuration\nAdd these redirect URLs:\n  ‚Ä¢ https://marketing-empire-dashboard.vercel.app/*\n  ‚Ä¢ http://localhost:*</pre>`;
                } else {
                    statusDiv.textContent = '‚úÖ CORS is working! Auth API accessible';
                    statusDiv.style.borderColor = '#0a0';
                    statusDiv.style.background = '#efe';
                    resultDiv.innerHTML = `<pre style="color: green;">‚úì No CORS errors!\n\nResponse: ${JSON.stringify(data, null, 2)}\n\nYour Supabase CORS configuration is correct!</pre>`;
                }
            } else {
                statusDiv.textContent = '‚úÖ CORS is working! Auth API accessible';
                statusDiv.style.borderColor = '#0a0';
                statusDiv.style.background = '#efe';
                resultDiv.innerHTML = `<pre style="color: green;">‚úì No CORS errors!\n\nSession: ${data.session ? 'Active session detected' : 'No active session (not logged in)'}\n\nYour Supabase CORS configuration is correct!\nYou can now use the login page safely.</pre>`;
            }
        } catch (error) {
            if (error.message && (error.message.includes('CORS') || error.message.includes('Failed to fetch'))) {
                statusDiv.textContent = '‚ùå CORS ERROR';
                statusDiv.style.borderColor = '#f00';
                statusDiv.style.background = '#fee';
                resultDiv.innerHTML = `<pre style="color: red;">CORS Error: ${error.message}\n\nFIX: Go to Supabase Dashboard > Authentication > URL Configuration\nAdd these redirect URLs:\n  ‚Ä¢ https://marketing-empire-dashboard.vercel.app/*\n  ‚Ä¢ http://localhost:*</pre>`;
            } else {
                statusDiv.textContent = '‚ö†Ô∏è Unexpected error';
                statusDiv.style.borderColor = '#ffa500';
                statusDiv.style.background = '#ffe';
                resultDiv.innerHTML = `<pre style="color: orange;">Error: ${error.message}</pre>`;
            }
        }
    </script>
</body>
</html>