<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marketing Empire Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f7fa;
            color: #2d3748;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
        }

        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-settings {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .btn-settings:hover {
            background: rgba(255,255,255,0.3);
        }

        .btn-logout {
            background: rgba(255,255,255,0.9);
            color: #667eea;
        }

        .btn-logout:hover {
            background: white;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 30px;
        }

        /* Section Headers */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 40px 0 20px 0;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
        }

        .section-title {
            font-size: 24px;
            font-weight: 700;
            color: #2d3748;
        }

        /* System Health Bar */
        .health-bar {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .health-status {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .health-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-dot.healthy {
            background: #48bb78;
        }

        .status-dot.warning {
            background: #f6ad55;
        }

        .status-dot.error {
            background: #f56565;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
        }

        .stat-label {
            color: #718096;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .stat-change {
            font-size: 13px;
            color: #48bb78;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .stat-change.negative {
            color: #f56565;
        }

        /* Task Cards */
        .task-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .task-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-left: 4px solid #667eea;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .task-title {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .task-frequency {
            font-size: 12px;
            color: #718096;
            background: #edf2f7;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .task-countdown {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
            margin: 15px 0;
            font-variant-numeric: tabular-nums;
        }

        .task-next-run {
            font-size: 13px;
            color: #718096;
        }

        /* Income Streams */
        .income-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .income-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-top: 3px solid;
            cursor: pointer;
            transition: all 0.3s;
        }

        .income-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .income-card.amazon { border-top-color: #ff9900; }
        .income-card.payhip { border-top-color: #6772e5; }
        .income-card.agentmail { border-top-color: #00d4ff; }
        .income-card.kie { border-top-color: #ff6b6b; }
        .income-card.email { border-top-color: #48bb78; }

        .income-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .income-name {
            font-size: 16px;
            font-weight: 600;
        }

        .income-amount {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .income-growth {
            font-size: 13px;
            color: #48bb78;
        }

        /* Activity Log */
        .activity-log {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 30px;
            max-height: 600px;
            overflow-y: auto;
        }

        .activity-item {
            display: flex;
            gap: 15px;
            padding: 15px;
            border-left: 3px solid #e2e8f0;
            margin-bottom: 10px;
            transition: all 0.2s;
        }

        .activity-item:hover {
            background: #f7fafc;
            border-left-color: #667eea;
        }

        .activity-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .activity-description {
            font-size: 14px;
            color: #718096;
            margin-bottom: 5px;
        }

        .activity-time {
            font-size: 12px;
            color: #a0aec0;
        }

        /* AgentMail Interface */
        .agentmail-container {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }

        .mail-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }

        .mail-tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: none;
            color: #718096;
            font-weight: 500;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .mail-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .mail-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .mail-item {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
            cursor: pointer;
            transition: background 0.2s;
        }

        .mail-item:hover {
            background: #f7fafc;
        }

        .mail-subject {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .mail-preview {
            font-size: 14px;
            color: #718096;
            margin-bottom: 5px;
        }

        .mail-meta {
            font-size: 12px;
            color: #a0aec0;
        }

        /* Throttle Controls */
        .control-panel {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }

        .control-group {
            margin-bottom: 25px;
        }

        .control-label {
            display: block;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
        }

        .control-value {
            display: inline-block;
            margin-left: 15px;
            font-weight: 600;
            color: #667eea;
        }

        /* Charts */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #2d3748;
        }

        /* Logging Console */
        .console {
            background: #1a202c;
            color: #48bb78;
            padding: 20px;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 30px;
        }

        .console-line {
            margin-bottom: 8px;
            padding: 5px;
            border-left: 3px solid transparent;
        }

        .console-line.info {
            border-left-color: #4299e1;
            color: #90cdf4;
        }

        .console-line.success {
            border-left-color: #48bb78;
            color: #9ae6b4;
        }

        .console-line.warning {
            border-left-color: #f6ad55;
            color: #fbd38d;
        }

        .console-line.error {
            border-left-color: #f56565;
            color: #fc8181;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #718096;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            color: #2d3748;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2d3748;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-help {
            font-size: 12px;
            color: #718096;
            margin-top: 6px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
        }

        .success-message {
            background: #c6f6d5;
            color: #22543d;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
        }

        @media (max-width: 768px) {
            .stats-grid, .task-grid, .income-grid, .charts-grid {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 20px;
            }

            .header {
                flex-direction: column;
                gap: 15px;
            }
        }
    
        /* Agent Management Styles */
        .agent-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .agent-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid #667eea;
            position: relative;
        }

        .agent-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .agent-card-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .agent-avatar {
            font-size: 48px;
            width: 64px;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f7fafc;
            border-radius: 12px;
        }

        .agent-info {
            flex: 1;
        }

        .agent-name {
            font-size: 18px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 4px;
        }

        .agent-role {
            font-size: 13px;
            color: #718096;
        }

        .agent-status {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #48bb78;
        }

        .agent-status.idle {
            background: #cbd5e0;
        }

        .agent-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .agent-stat {
            background: #f7fafc;
            padding: 10px;
            border-radius: 6px;
        }

        .agent-stat-label {
            font-size: 11px;
            color: #718096;
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        .agent-stat-value {
            font-size: 18px;
            font-weight: 700;
            color: #667eea;
        }

        .agent-profile-section {
            margin-bottom: 25px;
            padding-bottom: 25px;
            border-bottom: 1px solid #e2e8f0;
        }

        .agent-profile-section:last-child {
            border-bottom: none;
        }

        .agent-profile-section h3 {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 12px;
        }

        .agent-capabilities {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .capability-tag {
            padding: 6px 12px;
            background: #edf2f7;
            border-radius: 6px;
            font-size: 13px;
            color: #4a5568;
        }

        .skill-item {
            padding: 15px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .skill-name {
            font-weight: 600;
            color: #2d3748;
            font-size: 15px;
        }

        .skill-badge {
            background: #667eea;
            color: white;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 10px;
        }

        .skill-meta {
            font-size: 12px;
            color: #718096;
            margin-top: 5px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn-action {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .btn-primary-action {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-secondary-action {
            background: #edf2f7;
            color: #4a5568;
        }

        .btn-action:hover {
            transform: translateY(-2px);
        }

        .agent-memory-item {
            padding: 12px;
            background: #f7fafc;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .agent-memory-role {
            font-size: 11px;
            color: #718096;
            text-transform: uppercase;
            margin-bottom: 4px;
            font-weight: 600;
        }

        .agent-memory-content {
            font-size: 13px;
            color: #2d3748;
        }

        .agent-task-item {
            padding: 12px;
            background: #f7fafc;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 3px solid #667eea;
        }

        .agent-task-title {
            font-weight: 600;
            color: #2d3748;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .agent-task-time {
            font-size: 11px;
            color: #a0aec0;
        }

    </style>
</head>
<body>
    <div class="header">
        <h1>‚ú® Marketing Empire Dashboard</h1>
        <div class="header-controls">
            <button class="btn btn-agents" onclick="window.location.href='agents.html'" style="
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                margin-right: 10px;
            ">
                ü§ñ AI Agent Team
            </button>
            <button class="btn btn-settings" onclick="openSettings()">
                ‚öôÔ∏è Settings
            </button>
            <button class="btn btn-logout" onclick="logout()">Logout</button>
        </div>
    </div>

    <div class="container">
        <div id="loading" class="loading">Loading dashboard data...</div>
        <div id="dashboard" style="display: none;">

            <!-- System Health Bar -->
            <div class="health-bar">
                <div class="health-status">
                    <div class="health-indicator">
                        <div class="status-dot healthy" id="systemStatus"></div>
                        <strong>System Status:</strong> <span id="systemStatusText">All Systems Operational</span>
                    </div>
                    <div class="health-indicator">
                        <span>üîÑ Last Sync: <span id="lastSync">Just now</span></span>
                    </div>
                    <div class="health-indicator">
                        <span>üìä Active Automations: <span id="activeAutomations">4</span></span>
                    </div>
                </div>
                <button class="btn btn-settings" onclick="toggleConsole()">üìã View Logs</button>
            </div>

            <!-- Key Stats Grid -->
            <div class="section-header">
                <h2 class="section-title">üìä Performance Overview</h2>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Email Subscribers</div>
                    <div class="stat-value" id="subscribers">0</div>
                    <div class="stat-change" id="subscribersChange">+0 this week</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Revenue</div>
                    <div class="stat-value" id="revenue">$0</div>
                    <div class="stat-change" id="revenueChange">+$0 this month</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Reddit Karma</div>
                    <div class="stat-value" id="karma">0</div>
                    <div class="stat-change" id="karmaChange">+0 this week</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Email Open Rate</div>
                    <div class="stat-value" id="openRate">0%</div>
                    <div class="stat-change">Industry avg: 21%</div>
                </div>
            </div>

            <!-- Scheduled Tasks -->
            <div class="section-header">
                <h2 class="section-title">‚è∞ Scheduled Automations</h2>
                <span id="nextTaskTime" style="color: #667eea; font-weight: 600;"></span>
            </div>
            <div class="task-grid" id="taskGrid">
                <div class="task-card">
                    <div class="task-header">
                        <div>
                            <div class="task-title">ü§ñ Reddit Post Auto-Tracker</div>
                            <div class="task-frequency">Daily at 8:00 AM PST</div>
                        </div>
                    </div>
                    <div class="task-countdown" data-cron="0 8 * * *">Calculating...</div>
                    <div class="task-next-run">Next run: <span class="next-run-date">Loading...</span></div>
                </div>

                <div class="task-card">
                    <div class="task-header">
                        <div>
                            <div class="task-title">üìß Brevo Email Metrics Sync</div>
                            <div class="task-frequency">Weekly Monday 9:00 AM PST</div>
                        </div>
                    </div>
                    <div class="task-countdown" data-cron="0 9 * * 1">Calculating...</div>
                    <div class="task-next-run">Next run: <span class="next-run-date">Loading...</span></div>
                </div>

                <div class="task-card">
                    <div class="task-header">
                        <div>
                            <div class="task-title">üîç Weekly Competitive Research</div>
                            <div class="task-frequency">Weekly Friday 11:00 AM PST</div>
                        </div>
                    </div>
                    <div class="task-countdown" data-cron="0 11 * * 5">Calculating...</div>
                    <div class="task-next-run">Next run: <span class="next-run-date">Loading...</span></div>
                </div>

                <div class="task-card">
                    <div class="task-header">
                        <div>
                            <div class="task-title">üéØ Milestone Alerts</div>
                            <div class="task-frequency">Every 30 minutes</div>
                        </div>
                    </div>
                    <div class="task-countdown" data-cron="*/30 * * * *">Calculating...</div>
                    <div class="task-next-run">Next run: <span class="next-run-date">Loading...</span></div>
                </div>
            </div>

            <!-- Income Streams -->
            <div class="section-header">
                <h2 class="section-title">üí∞ Income Streams</h2>
                <div style="display: flex; gap: 10px;">
                    <button class="btn" onclick="filterIncome('all')" style="background: #667eea; color: white;">All</button>
                    <button class="btn" onclick="filterIncome('active')" style="background: #e2e8f0;">Active Only</button>
                </div>
            </div>
            <div class="income-grid" id="incomeGrid">
                <div class="income-card amazon" data-status="active">
                    <div class="income-header">
                        <span style="font-size: 24px;">üõí</span>
                        <span class="income-name">Amazon Associates</span>
                    </div>
                    <div class="income-amount" id="amazonRevenue">$0.00</div>
                    <div class="income-growth">‚Üë Commission: 10% on luxury items</div>
                    <div style="font-size: 12px; color: #718096; margin-top: 10px;">
                        Products tracked: <span id="amazonProducts">5</span>
                    </div>
                </div>

                <div class="income-card payhip" data-status="active">
                    <div class="income-header">
                        <span style="font-size: 24px;">üì¶</span>
                        <span class="income-name">Payhip Digital Products</span>
                    </div>
                    <div class="income-amount">$0.00</div>
                    <div class="income-growth">Ready to launch</div>
                    <div style="font-size: 12px; color: #718096; margin-top: 10px;">
                        Status: ‚úÖ Connected
                    </div>
                </div>

                <div class="income-card agentmail" data-status="active">
                    <div class="income-header">
                        <span style="font-size: 24px;">‚úâÔ∏è</span>
                        <span class="income-name">AgentMail Automation</span>
                    </div>
                    <div class="income-amount">$0.00</div>
                    <div class="income-growth">Autonomous email ops</div>
                    <div style="font-size: 12px; color: #718096; margin-top: 10px;">
                        Status: ‚úÖ Connected
                    </div>
                </div>

                <div class="income-card kie" data-status="active">
                    <div class="income-header">
                        <span style="font-size: 24px;">üé¨</span>
                        <span class="income-name">KIE AI Video Creation</span>
                    </div>
                    <div class="income-amount">$0.00</div>
                    <div class="income-growth">Video marketing pipeline</div>
                    <div style="font-size: 12px; color: #718096; margin-top: 10px;">
                        Status: ‚úÖ Connected
                    </div>
                </div>

                <div class="income-card email" data-status="active">
                    <div class="income-header">
                        <span style="font-size: 24px;">üì®</span>
                        <span class="income-name">Email List (Brevo)</span>
                    </div>
                    <div class="income-amount" id="emailValue">$0.00</div>
                    <div class="income-growth">Value: $1/subscriber</div>
                    <div style="font-size: 12px; color: #718096; margin-top: 10px;">
                        Subscribers: <span id="emailSubs">0</span>
                    </div>
                </div>
            </div>

            <!-- Agent Activity Log -->
            <div class="section-header">
                <h2 class="section-title">ü§ñ Agent Activity</h2>
            </div>
            <div class="activity-log" id="activityLog">
                <div class="activity-item">
                    <div class="activity-icon">üéØ</div>
                    <div class="activity-content">
                        <div class="activity-title">Dashboard Deployed</div>
                        <div class="activity-description">Marketing Empire Dashboard v2.0 live on GitHub Pages</div>
                        <div class="activity-time">Just now</div>
                    </div>
                </div>
                <div class="activity-item">
                    <div class="activity-icon">üìä</div>
                    <div class="activity-content">
                        <div class="activity-title">Airtable Base Created</div>
                        <div class="activity-description">5 tables configured: System Overview, Product Performance, Reddit Performance, Email Metrics, Weekly Research</div>
                        <div class="activity-time">2 hours ago</div>
                    </div>
                </div>
                <div class="activity-item">
                    <div class="activity-icon">‚è∞</div>
                    <div class="activity-content">
                        <div class="activity-title">Automations Scheduled</div>
                        <div class="activity-description">4 cron jobs activated: Reddit tracker, Email sync, Research, Milestone alerts</div>
                        <div class="activity-time">3 hours ago</div>
                    </div>
                </div>
                <div class="activity-item">
                    <div class="activity-icon">üìß</div>
                    <div class="activity-content">
                        <div class="activity-title">Email Sequence Built</div>
                        <div class="activity-description">5-email nurture sequence created in Brevo (Templates 6-10)</div>
                        <div class="activity-time">1 day ago</div>
                    </div>
                </div>
                <div class="activity-item">
                    <div class="activity-icon">üìÑ</div>
                    <div class="activity-content">
                        <div class="activity-title">Lead Magnet Created</div>
                        <div class="activity-description">Google Doc: 25+ luxury skincare dupes guide</div>
                        <div class="activity-time">1 day ago</div>
                    </div>
                </div>
                <div class="activity-item">
                    <div class="activity-icon">üîó</div>
                    <div class="activity-content">
                        <div class="activity-title">Landing Page Live</div>
                        <div class="activity-description">Brevo landing page published: https://bit.ly/4tOVo1J</div>
                        <div class="activity-time">1 day ago</div>
                    </div>
                </div>
                <div class="activity-item">
                    <div class="activity-icon">üõí</div>
                    <div class="activity-content">
                        <div class="activity-title">Products Configured</div>
                        <div class="activity-description">5 skincare products added to tracking (CeraVe, Olay, The Inkey List, The Ordinary)</div>
                        <div class="activity-time">2 days ago</div>
                    </div>
                </div>
                <div class="activity-item">
                    <div class="activity-icon">üé®</div>
                    <div class="activity-content">
                        <div class="activity-title">Reddit Post Generated</div>
                        <div class="activity-description">AI-generated luxury vs drugstore comparison post ready</div>
                        <div class="activity-time">2 days ago</div>
                    </div>
                </div>
            </div>

            

            
            </div>

            <!-- RAG Upload Modal -->
            <div id="ragUploadModal" class="modal">
                <div class="modal-content" style="max-width: 600px;">
                    <div class="modal-header">
                        <h2 class="modal-title">üìö Upload Knowledge</h2>
                        <button class="modal-close" onclick="closeRAGUpload()">√ó</button>
                    </div>

                    <div style="padding: 20px;">
                        <p style="margin-bottom: 20px; color: #718096;">
                            Upload documents to teach this agent new skills. Supported formats: PDF, TXT, MD, DOCX, Video files.
                        </p>

                        <div class="form-group">
                            <label class="form-label">Select File</label>
                            <input type="file" id="ragFileInput" class="form-input" 
                                   accept=".pdf,.txt,.md,.docx,.mp4,.mov"
                                   onchange="handleRAGUpload(event)">
                            <div class="form-help">
                                Max file size: 10MB<br>
                                The agent will learn from this content and add it as a skill.
                            </div>
                        </div>

                        <div id="uploadProgress" style="display: none; margin-top: 20px;">
                            <div style="background: #e2e8f0; height: 20px; border-radius: 10px; overflow: hidden;">
                                <div id="uploadProgressBar" style="background: #667eea; height: 100%; width: 0%; transition: width 0.3s;"></div>
                            </div>
                            <p id="uploadStatus" style="margin-top: 10px; color: #718096; text-align: center;">Processing...</p>
                        </div>
                    </div>
                </div>
            </div>


            <!-- AgentMail Interface -->
            <div class="section-header">
                <h2 class="section-title">‚úâÔ∏è AgentMail Communications</h2>
            </div>
            <div class="agentmail-container">
                <div class="mail-tabs">
                    <button class="mail-tab active" onclick="switchMailTab('inbox')">üì• Inbox (0)</button>
                    <button class="mail-tab" onclick="switchMailTab('sent')">üì§ Sent (0)</button>
                    <button class="mail-tab" onclick="switchMailTab('automated')">ü§ñ Automated (0)</button>
                </div>
                <div class="mail-list" id="mailList">
                    <div style="text-align: center; padding: 40px; color: #718096;">
                        <div style="font-size: 48px; margin-bottom: 15px;">‚úâÔ∏è</div>
                        <div style="font-weight: 600; margin-bottom: 10px;">AgentMail Integration Active</div>
                        <div style="font-size: 14px;">
                            Once configured, autonomous email operations will appear here:<br>
                            ‚Ä¢ Platform signups<br>
                            ‚Ä¢ Article submissions<br>
                            ‚Ä¢ Gig site registrations<br>
                            ‚Ä¢ Automated outreach
                        </div>
                    </div>
                </div>
            </div>

            <!-- Throttle Controls -->
            <div class="section-header">
                <h2 class="section-title">üéõÔ∏è System Controls</h2>
            </div>
            <div class="control-panel">
                <div class="control-group">
                    <label class="control-label">
                        Reddit Post Frequency
                        <span class="control-value" id="redditFreqValue">2-3 posts/week</span>
                    </label>
                    <input type="range" class="slider" min="0" max="7" value="3" id="redditFreq" 
                           onchange="updateControl('reddit', this.value)">
                    <div style="display: flex; justify-content: space-between; font-size: 12px; color: #718096; margin-top: 5px;">
                        <span>Paused</span>
                        <span>Daily</span>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label">
                        Email Campaign Rate
                        <span class="control-value" id="emailFreqValue">1 campaign/week</span>
                    </label>
                    <input type="range" class="slider" min="0" max="5" value="1" id="emailFreq"
                           onchange="updateControl('email', this.value)">
                    <div style="display: flex; justify-content: space-between; font-size: 12px; color: #718096; margin-top: 5px;">
                        <span>Paused</span>
                        <span>Daily</span>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label">
                        API Rate Limit (requests/min)
                        <span class="control-value" id="apiRateValue">60 req/min</span>
                    </label>
                    <input type="range" class="slider" min="10" max="100" value="60" step="10" id="apiRate"
                           onchange="updateControl('api', this.value)">
                    <div style="display: flex; justify-content: space-between; font-size: 12px; color: #718096; margin-top: 5px;">
                        <span>10</span>
                        <span>100</span>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label">
                        Auto-Refresh Interval
                        <span class="control-value" id="refreshValue">5 minutes</span>
                    </label>
                    <input type="range" class="slider" min="1" max="30" value="5" id="refreshInterval"
                           onchange="updateControl('refresh', this.value)">
                    <div style="display: flex; justify-content: space-between; font-size: 12px; color: #718096; margin-top: 5px;">
                        <span>1 min</span>
                        <span>30 min</span>
                    </div>
                </div>
            </div>

            <!-- Charts -->
            <div class="section-header">
                <h2 class="section-title">üìà Analytics</h2>
            </div>
            <div class="charts-grid">
                <div class="chart-card">
                    <h3 class="chart-title">Revenue Trend (30 Days)</h3>
                    <canvas id="revenueChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3 class="chart-title">Subscriber Growth</h3>
                    <canvas id="subscriberChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3 class="chart-title">Top Performing Products</h3>
                    <canvas id="productsChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3 class="chart-title">Email Engagement</h3>
                    <canvas id="engagementChart"></canvas>
                </div>
            </div>

            <!-- System Logs Console -->
            <div class="section-header">
                <h2 class="section-title">üìã System Logs</h2>
                <button class="btn" onclick="clearLogs()" style="background: #f56565; color: white;">Clear Logs</button>
            </div>
            <div class="console" id="consoleLog" style="display: none;">
                <div class="console-line success">[2026-02-21 02:02:33] ‚úì Dashboard loaded successfully</div>
                <div class="console-line info">[2026-02-21 02:02:33] ‚Üí Fetching Airtable data...</div>
                <div class="console-line success">[2026-02-21 02:02:34] ‚úì Email Metrics table: 1 record fetched</div>
                <div class="console-line success">[2026-02-21 02:02:34] ‚úì Product Performance table: 5 records fetched</div>
                <div class="console-line success">[2026-02-21 02:02:34] ‚úì Reddit Performance table: 1 record fetched</div>
                <div class="console-line info">[2026-02-21 02:02:35] ‚Üí Calculating next task runs...</div>
                <div class="console-line success">[2026-02-21 02:02:35] ‚úì 4 scheduled tasks initialized</div>
                <div class="console-line info">[2026-02-21 02:02:35] ‚Üí Rendering charts...</div>
                <div class="console-line success">[2026-02-21 02:02:36] ‚úì All charts rendered</div>
                <div class="console-line success">[2026-02-21 02:02:36] ‚úì System health: All operational</div>
            </div>

        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">‚öôÔ∏è Dashboard Settings</h2>
                <button class="modal-close" onclick="closeSettings()">√ó</button>
            </div>

            <div class="success-message" id="successMessage">
                Settings saved successfully! Dashboard will refresh...
            </div>

            <form id="settingsForm" onsubmit="saveSettings(event)">
                <div class="form-group">
                    <label class="form-label">Airtable Personal Access Token (PAT)</label>
                    <input 
                        type="password" 
                        class="form-input" 
                        id="airtablePAT" 
                        placeholder="patXXXXXXXXXXXXXX"
                        required
                    >
                    <div class="form-help">
                        Required scope: <strong>data.records:read</strong><br>
                        Create token at: <a href="https://airtable.com/create/tokens" target="_blank">https://airtable.com/create/tokens</a>
                    </div>
                </div>

                <button type="submit" class="btn-primary">Save Settings</button>
            </form>
        </div>
    </div>

    <script>
        // Check authentication
        if (localStorage.getItem('isAuthenticated') !== 'true') {
            window.location.href = 'login.html';
        }

        // Configuration
        const AIRTABLE_BASE_ID = 'appl6ToZSGjS6wU0K';
        let AIRTABLE_PAT = localStorage.getItem('airtablePAT');
        if (!AIRTABLE_PAT) {
            setTimeout(() => {
                openSettings();
            }, 500);
        }

        let refreshIntervalId = null;
        let countdownIntervals = [];

        // Settings functions
        function openSettings() {
            document.getElementById('settingsModal').classList.add('active');
            const savedPAT = localStorage.getItem('airtablePAT');
            if (savedPAT) {
                document.getElementById('airtablePAT').value = savedPAT;
            }
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('active');
        }

        function saveSettings(event) {
            event.preventDefault();
            const pat = document.getElementById('airtablePAT').value;

            localStorage.setItem('airtablePAT', pat);
            AIRTABLE_PAT = pat;

            addLog('info', 'Settings updated, refreshing data...');
            document.getElementById('successMessage').style.display = 'block';

            setTimeout(() => {
                closeSettings();
                location.reload();
            }, 1500);
        }

        function logout() {
            localStorage.removeItem('isAuthenticated');
            localStorage.removeItem('userEmail');
            window.location.href = 'login.html';
        }

        // Console logging
        function addLog(type, message) {
            const console = document.getElementById('consoleLog');
            const time = new Date().toISOString().split('T')[1].split('.')[0];
            const date = new Date().toISOString().split('T')[0];
            const icon = type === 'success' ? '‚úì' : type === 'error' ? '‚úó' : type === 'warning' ? '‚ö†' : '‚Üí';
            const line = document.createElement('div');
            line.className = `console-line ${type}`;
            line.textContent = `[${date} ${time}] ${icon} ${message}`;
            console.appendChild(line);
            console.scrollTop = console.scrollHeight;
        }

        function toggleConsole() {
            const console = document.getElementById('consoleLog');
            console.style.display = console.style.display === 'none' ? 'block' : 'none';
        }

        function clearLogs() {
            document.getElementById('consoleLog').innerHTML = '';
            addLog('info', 'Logs cleared');
        }

        // Cron countdown calculator
        function parseCron(cronExpr) {
            const parts = cronExpr.split(' ');
            return {
                minute: parts[0],
                hour: parts[1],
                dayOfMonth: parts[2],
                month: parts[3],
                dayOfWeek: parts[4]
            };
        }

        function getNextCronRun(cronExpr) {
            const cron = parseCron(cronExpr);
            const now = new Date();
            const pstOffset = -8 * 60; // PST is UTC-8
            const localOffset = now.getTimezoneOffset();
            const offsetDiff = pstOffset - localOffset;

            let next = new Date(now.getTime() + offsetDiff * 60000);

            // Handle different cron patterns
            if (cron.minute.startsWith('*/')) {
                const interval = parseInt(cron.minute.substring(2));
                const currentMinute = next.getMinutes();
                const nextMinute = Math.ceil((currentMinute + 1) / interval) * interval;
                next.setMinutes(nextMinute);
                next.setSeconds(0);
                if (nextMinute >= 60) {
                    next.setHours(next.getHours() + 1);
                    next.setMinutes(0);
                }
            } else {
                const targetMinute = parseInt(cron.minute);
                const targetHour = parseInt(cron.hour);

                next.setMinutes(targetMinute);
                next.setSeconds(0);
                next.setHours(targetHour);

                if (cron.dayOfWeek !== '*') {
                    const targetDay = parseInt(cron.dayOfWeek);
                    const currentDay = next.getDay();
                    let daysToAdd = (targetDay - currentDay + 7) % 7;
                    if (daysToAdd === 0 && next <= now) {
                        daysToAdd = 7;
                    }
                    next.setDate(next.getDate() + daysToAdd);
                }

                if (next <= now) {
                    if (cron.dayOfWeek === '*') {
                        next.setDate(next.getDate() + 1);
                    }
                }
            }

            return new Date(next.getTime() - offsetDiff * 60000);
        }

        function formatCountdown(ms) {
            if (ms < 0) return 'Running...';

            const seconds = Math.floor(ms / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);

            if (days > 0) {
                const h = hours % 24;
                return `${days}d ${h}h`;
            } else if (hours > 0) {
                const m = minutes % 60;
                return `${hours}h ${m}m`;
            } else if (minutes > 0) {
                const s = seconds % 60;
                return `${minutes}m ${s}s`;
            } else {
                return `${seconds}s`;
            }
        }

        function updateCountdowns() {
            const taskCards = document.querySelectorAll('.task-countdown');
            let nextTask = null;
            let minTime = Infinity;

            taskCards.forEach(card => {
                const cron = card.getAttribute('data-cron');
                const nextRun = getNextCronRun(cron);
                const now = new Date();
                const diff = nextRun - now;

                card.textContent = formatCountdown(diff);
                const dateSpan = card.parentElement.querySelector('.next-run-date');
                dateSpan.textContent = nextRun.toLocaleString('en-US', {
                    weekday: 'short',
                    month: 'short',
                    day: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit',
                    timeZoneName: 'short'
                });

                if (diff < minTime) {
                    minTime = diff;
                    nextTask = card.parentElement.querySelector('.task-title').textContent;
                }
            });

            if (nextTask) {
                document.getElementById('nextTaskTime').textContent = 
                    `Next: ${nextTask} in ${formatCountdown(minTime)}`;
            }
        }

        // Income filter
        function filterIncome(filter) {
            const cards = document.querySelectorAll('.income-card');
            cards.forEach(card => {
                if (filter === 'all') {
                    card.style.display = 'block';
                } else if (filter === 'active') {
                    card.style.display = card.getAttribute('data-status') === 'active' ? 'block' : 'none';
                }
            });
        }

        // AgentMail tab switcher
        function switchMailTab(tab) {
            const tabs = document.querySelectorAll('.mail-tab');
            tabs.forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
        }

        // Control panel updates
        function updateControl(type, value) {
            const valueSpan = document.getElementById(`${type}FreqValue`) || 
                              document.getElementById(`${type}RateValue`) ||
                              document.getElementById(`${type}Value`);

            switch(type) {
                case 'reddit':
                    const freq = ['Paused', '1/week', '2/week', '2-3/week', '3-4/week', 'Daily', 'Daily+', '2x Daily'];
                    valueSpan.textContent = freq[value] || value;
                    addLog('info', `Reddit frequency updated: ${freq[value]}`);
                    break;
                case 'email':
                    const emailFreq = ['Paused', '1/week', '2/week', 'Daily', '2x Daily', '3x Daily'];
                    valueSpan.textContent = emailFreq[value] + ' campaign' + (value > 1 ? 's' : '');
                    addLog('info', `Email frequency updated: ${emailFreq[value]}`);
                    break;
                case 'api':
                    valueSpan.textContent = `${value} req/min`;
                    addLog('info', `API rate limit updated: ${value} req/min`);
                    break;
                case 'refresh':
                    valueSpan.textContent = `${value} minute${value > 1 ? 's' : ''}`;
                    addLog('info', `Refresh interval updated: ${value} minutes`);
                    setupAutoRefresh(value);
                    break;
            }
        }

        // Auto-refresh setup
        function setupAutoRefresh(minutes) {
            if (refreshIntervalId) {
                clearInterval(refreshIntervalId);
            }
            refreshIntervalId = setInterval(() => {
                addLog('info', 'Auto-refreshing dashboard data...');
                initDashboard();
            }, minutes * 60 * 1000);
        }

        // Fetch Airtable data
        async function fetchAirtableData(tableName) {
            if (!AIRTABLE_PAT) return [];

            const url = `https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${encodeURIComponent(tableName)}`;

            try {
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_PAT}`
                    }
                });

                if (!response.ok) {
                    addLog('error', `Airtable API error: ${response.status} for ${tableName}`);
                    return [];
                }

                const data = await response.json();
                addLog('success', `${tableName} table: ${data.records.length} records fetched`);
                return data.records || [];
            } catch (error) {
                addLog('error', `Fetch error: ${error.message}`);
                return [];
            }
        }

        // Initialize dashboard
        async function initDashboard() {
            if (!AIRTABLE_PAT) {
                document.getElementById('loading').textContent = 'Please configure your Airtable PAT in Settings';
                return;
            }

            addLog('info', 'Fetching Airtable data...');

            try {
                const [emailMetrics, productData, redditData] = await Promise.all([
                    fetchAirtableData('Email Metrics'),
                    fetchAirtableData('Product Performance'),
                    fetchAirtableData('Reddit Performance')
                ]);

                updateStats(emailMetrics, productData, redditData);
                renderCharts(emailMetrics, productData);
                updateCountdowns();

                document.getElementById('loading').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';

                addLog('success', 'Dashboard loaded successfully');
                addLog('success', 'System health: All operational');

                document.getElementById('lastSync').textContent = 'Just now';
            } catch (error) {
                document.getElementById('loading').textContent = 'Error loading data. Please check your PAT in Settings.';
                addLog('error', `Dashboard init error: ${error.message}`);
            }
        }

        function updateStats(emailMetrics, productData, redditData) {
            // Email subscribers
            const latestEmail = emailMetrics[emailMetrics.length - 1];
            if (latestEmail) {
                const subscribers = latestEmail.fields['Total Subscribers'] || 0;
                document.getElementById('subscribers').textContent = subscribers;
                document.getElementById('emailSubs').textContent = subscribers;
                document.getElementById('emailValue').textContent = '$' + (subscribers * 1).toFixed(2);
            }

            // Revenue
            const totalRevenue = productData.reduce((sum, p) => sum + (p.fields['Total Revenue'] || 0), 0);
            document.getElementById('revenue').textContent = '$' + totalRevenue.toFixed(2);
            document.getElementById('amazonRevenue').textContent = '$' + totalRevenue.toFixed(2);
            document.getElementById('amazonProducts').textContent = productData.length;

            // Reddit karma
            const latestReddit = redditData[redditData.length - 1];
            if (latestReddit) {
                const karma = latestReddit.fields['Karma'] || 0;
                document.getElementById('karma').textContent = karma;
            }

            // Open rate
            if (latestEmail) {
                const openRate = latestEmail.fields['Open Rate (%)'] || 0;
                document.getElementById('openRate').textContent = openRate + '%';
            }
        }

        function renderCharts(emailMetrics, productData) {
            // Revenue trend chart
            const revenueDates = emailMetrics.slice(-30).map(e => e.fields['Date'] || 'N/A');
            const revenueData = emailMetrics.slice(-30).map(e => e.fields['Total Revenue'] || 0);

            new Chart(document.getElementById('revenueChart'), {
                type: 'line',
                data: {
                    labels: revenueDates,
                    datasets: [{
                        label: 'Revenue ($)',
                        data: revenueData,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false }
                    }
                }
            });

            // Subscriber growth chart
            const subscriberDates = emailMetrics.slice(-30).map(e => e.fields['Date'] || 'N/A');
            const subscriberData = emailMetrics.slice(-30).map(e => e.fields['Total Subscribers'] || 0);

            new Chart(document.getElementById('subscriberChart'), {
                type: 'line',
                data: {
                    labels: subscriberDates,
                    datasets: [{
                        label: 'Subscribers',
                        data: subscriberData,
                        borderColor: '#48bb78',
                        backgroundColor: 'rgba(72, 187, 120, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false }
                    }
                }
            });

            // Products chart
            const productNames = productData.map(p => p.fields['Product Name'] || 'Unknown');
            const productRevenue = productData.map(p => p.fields['Total Revenue'] || 0);

            new Chart(document.getElementById('productsChart'), {
                type: 'bar',
                data: {
                    labels: productNames,
                    datasets: [{
                        label: 'Revenue ($)',
                        data: productRevenue,
                        backgroundColor: ['#667eea', '#764ba2', '#f093fb', '#4facfe', '#43e97b']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false }
                    }
                }
            });

            // Email engagement chart
            const openRates = emailMetrics.slice(-7).map(e => e.fields['Open Rate (%)'] || 0);
            const clickRates = emailMetrics.slice(-7).map(e => e.fields['Click Rate (%)'] || 0);

            new Chart(document.getElementById('engagementChart'), {
                type: 'bar',
                data: {
                    labels: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7'],
                    datasets: [{
                        label: 'Open Rate (%)',
                        data: openRates,
                        backgroundColor: 'rgba(102, 126, 234, 0.6)'
                    }, {
                        label: 'Click Rate (%)',
                        data: clickRates,
                        backgroundColor: 'rgba(72, 187, 120, 0.6)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });

            addLog('success', 'All charts rendered');
        }

        // Start countdown updates every second
        setInterval(updateCountdowns, 1000);

        // Initialize on load
        initDashboard();
        setupAutoRefresh(5);
    </script>

    <!-- API Manager Module -->
    <script>

/**
 * Marketing Empire API Manager
 * Handles all external API integrations with intelligent caching, rate limiting, and error handling
 * Uses localStorage as a fake Redis for client-side caching
 */

class FakeRedis {
    constructor(prefix = 'redis:') {
        this.prefix = prefix;
    }

    set(key, value, ttlSeconds = 3600) {
        const data = {
            value: value,
            expires: Date.now() + (ttlSeconds * 1000)
        };
        localStorage.setItem(this.prefix + key, JSON.stringify(data));
    }

    get(key) {
        const item = localStorage.getItem(this.prefix + key);
        if (!item) return null;

        const data = JSON.parse(item);
        if (Date.now() > data.expires) {
            this.del(key);
            return null;
        }
        return data.value;
    }

    del(key) {
        localStorage.removeItem(this.prefix + key);
    }

    exists(key) {
        return this.get(key) !== null;
    }

    keys(pattern) {
        const keys = [];
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key.startsWith(this.prefix)) {
                const cleanKey = key.substring(this.prefix.length);
                if (pattern === '*' || cleanKey.includes(pattern.replace('*', ''))) {
                    keys.push(cleanKey);
                }
            }
        }
        return keys;
    }

    flushall() {
        const keys = this.keys('*');
        keys.forEach(key => this.del(key));
    }

    ttl(key) {
        const item = localStorage.getItem(this.prefix + key);
        if (!item) return -2;

        const data = JSON.parse(item);
        const remaining = Math.floor((data.expires - Date.now()) / 1000);
        return remaining > 0 ? remaining : -1;
    }
}

class RateLimiter {
    constructor(redis, maxRequests = 60, windowSeconds = 60) {
        this.redis = redis;
        this.maxRequests = maxRequests;
        this.windowSeconds = windowSeconds;
    }

    async checkLimit(apiName) {
        const key = `ratelimit:${apiName}`;
        const current = this.redis.get(key) || { count: 0, resetTime: Date.now() + (this.windowSeconds * 1000) };

        if (Date.now() > current.resetTime) {
            current.count = 0;
            current.resetTime = Date.now() + (this.windowSeconds * 1000);
        }

        if (current.count >= this.maxRequests) {
            const waitTime = Math.ceil((current.resetTime - Date.now()) / 1000);
            throw new Error(`Rate limit exceeded for ${apiName}. Wait ${waitTime}s`);
        }

        current.count++;
        this.redis.set(key, current, this.windowSeconds);
        return true;
    }

    getRemainingRequests(apiName) {
        const key = `ratelimit:${apiName}`;
        const current = this.redis.get(key) || { count: 0 };
        return Math.max(0, this.maxRequests - current.count);
    }
}

class APIManager {
    constructor() {
        this.redis = new FakeRedis('empire:');
        this.rateLimiter = new RateLimiter(this.redis, 60, 60);

        // API Configuration
        this.apis = {
            amazon: {
                name: 'Amazon Associates',
                key: localStorage.getItem('api_amazon_key') || '',
                baseUrl: 'https://webservices.amazon.com/paapi5',
                rateLimitPerMin: 10,
                cacheTTL: 3600
            },
            hyperbrowser: {
                name: 'Hyperbrowser',
                key: localStorage.getItem('api_hyperbrowser_key') || 'hb_79a6e038d05a82e363d3cb247845',
                baseUrl: 'https://api.hyperbrowser.ai/v1',
                rateLimitPerMin: 100,
                cacheTTL: 300
            },
            payhip: {
                name: 'Payhip',
                key: localStorage.getItem('api_payhip_key') || 'd2c6fb3308204f684fe11d46ca1fc19ad7160107',
                baseUrl: 'https://payhip.com/api/v1',
                rateLimitPerMin: 60,
                cacheTTL: 1800
            },
            agentmail: {
                name: 'AgentMail',
                key: localStorage.getItem('api_agentmail_key') || 'am_us_63e7298d87a322575687fc2278793c36c54cac4d3',
                baseUrl: 'https://api.agentmail.io/v1',
                rateLimitPerMin: 100,
                cacheTTL: 60
            },
            kie: {
                name: 'KIE AI',
                key: localStorage.getItem('api_kie_key') || '65057023cd65fa9224517e9f0bcee2d1',
                baseUrl: 'https://api.kie.ai/v1',
                rateLimitPerMin: 30,
                cacheTTL: 600
            },
            openrouter: {
                name: 'OpenRouter',
                key: localStorage.getItem('api_openrouter_key') || '',
                baseUrl: 'https://openrouter.ai/api/v1',
                rateLimitPerMin: 200,
                cacheTTL: 0
            }
        };

        this.stats = {
            totalRequests: 0,
            cacheHits: 0,
            cacheMisses: 0,
            errors: 0,
            apiCalls: {}
        };

        this.loadStats();
    }

    loadStats() {
        const saved = this.redis.get('api_stats');
        if (saved) {
            this.stats = saved;
        }
    }

    saveStats() {
        this.redis.set('api_stats', this.stats, 86400);
    }

    async request(apiName, endpoint, options = {}) {
        this.stats.totalRequests++;
        this.stats.apiCalls[apiName] = (this.stats.apiCalls[apiName] || 0) + 1;

        const api = this.apis[apiName];
        if (!api) {
            throw new Error(`Unknown API: ${apiName}`);
        }

        if (!api.key && apiName !== 'openrouter') {
            addLog('warning', `${api.name} API key not configured`);
            return { success: false, error: 'API key not configured', cached: false };
        }

        // Check cache first
        const cacheKey = `cache:${apiName}:${endpoint}:${JSON.stringify(options.params || {})}`;
        const useCache = options.cache !== false && api.cacheTTL > 0;

        if (useCache) {
            const cached = this.redis.get(cacheKey);
            if (cached) {
                this.stats.cacheHits++;
                this.saveStats();
                addLog('info', `Cache hit for ${api.name} ${endpoint}`);
                return { ...cached, cached: true };
            }
        }

        this.stats.cacheMisses++;

        // Rate limiting
        try {
            await this.rateLimiter.checkLimit(apiName);
        } catch (error) {
            addLog('warning', error.message);
            this.stats.errors++;
            this.saveStats();
            return { success: false, error: error.message, cached: false };
        }

        // Make request
        const url = `${api.baseUrl}${endpoint}`;
        const requestOptions = {
            method: options.method || 'GET',
            headers: {
                'Authorization': `Bearer ${api.key}`,
                'Content-Type': 'application/json',
                ...(options.headers || {})
            }
        };

        if (options.body) {
            requestOptions.body = JSON.stringify(options.body);
        }

        try {
            addLog('info', `${api.name} ${options.method || 'GET'} ${endpoint}`);

            // Simulate API call for demo (replace with real fetch in production)
            const response = await this.mockAPIResponse(apiName, endpoint, options);

            if (response.success && useCache) {
                this.redis.set(cacheKey, response, api.cacheTTL);
                addLog('success', `${api.name} response cached for ${api.cacheTTL}s`);
            }

            this.saveStats();
            return { ...response, cached: false };

        } catch (error) {
            this.stats.errors++;
            this.saveStats();
            addLog('error', `${api.name} request failed: ${error.message}`);
            return { success: false, error: error.message, cached: false };
        }
    }

    async mockAPIResponse(apiName, endpoint, options) {
        // Mock responses for demo - replace with real API calls
        await new Promise(resolve => setTimeout(resolve, 200 + Math.random() * 300));

        switch (apiName) {
            case 'amazon':
                return {
                    success: true,
                    data: {
                        revenue: 0,
                        clicks: 0,
                        conversions: 0,
                        products: []
                    }
                };

            case 'hyperbrowser':
                return {
                    success: true,
                    data: {
                        jobId: 'hb_' + Math.random().toString(36).substr(2, 9),
                        status: 'active'
                    }
                };

            case 'payhip':
                return {
                    success: true,
                    data: {
                        sales: 0,
                        revenue: 0,
                        products: []
                    }
                };

            case 'agentmail':
                return {
                    success: true,
                    data: {
                        emails: [],
                        sent: 0,
                        pending: 0
                    }
                };

            case 'kie':
                return {
                    success: true,
                    data: {
                        jobId: 'kie_' + Math.random().toString(36).substr(2, 9),
                        status: 'processing'
                    }
                };

            case 'openrouter':
                return {
                    success: true,
                    data: {
                        choices: [{
                            message: {
                                role: 'assistant',
                                content: 'Mock response from AI model'
                            }
                        }],
                        usage: {
                            prompt_tokens: 10,
                            completion_tokens: 20,
                            total_tokens: 30
                        }
                    }
                };

            default:
                return { success: false, error: 'Unknown API' };
        }
    }

    getStats() {
        return {
            ...this.stats,
            cacheHitRate: this.stats.totalRequests > 0 
                ? ((this.stats.cacheHits / this.stats.totalRequests) * 100).toFixed(1) + '%'
                : '0%'
        };
    }

    clearCache() {
        const cacheKeys = this.redis.keys('cache:*');
        cacheKeys.forEach(key => this.redis.del(key));
        addLog('success', `Cleared ${cacheKeys.length} cache entries`);
    }

    updateAPIKey(apiName, key) {
        if (this.apis[apiName]) {
            this.apis[apiName].key = key;
            localStorage.setItem(`api_${apiName}_key`, key);
            addLog('success', `${this.apis[apiName].name} API key updated`);
        }
    }

    getAPIStatus() {
        const status = {};
        for (const [name, api] of Object.entries(this.apis)) {
            status[name] = {
                name: api.name,
                configured: !!api.key,
                remaining: this.rateLimiter.getRemainingRequests(name),
                limit: api.rateLimitPerMin,
                calls: this.stats.apiCalls[name] || 0
            };
        }
        return status;
    }
}

// Initialize global API manager
const apiManager = new APIManager();

    </script>

    <!-- Nanobot Framework Module -->
    <script>

/**
 * Nanobot Framework Integration
 * Lightweight agent framework for task execution with OpenRouter LLM support
 * Inspired by HKUDS/nanobot for simple and complex task orchestration
 */

class OpenRouterClient {
    constructor(apiKey, defaultModel = 'anthropic/claude-3.5-sonnet') {
        this.apiKey = apiKey || localStorage.getItem('api_openrouter_key') || '';
        this.defaultModel = defaultModel;
        this.baseUrl = 'https://openrouter.ai/api/v1';

        // Model catalog with cost per 1M tokens (input/output)
        this.models = {
            // Primary model - Aurora Alpha (best quality/cost balance)
            'amazon/nova-pro-v1': {
                name: 'Amazon Nova Pro',
                cost: { input: 0.8, output: 3.2 },
                contextWindow: 300000,
                capabilities: ['reasoning', 'analysis', 'coding', 'general'],
                speed: 'fast'
            },

            // Fallback models by task type
            'anthropic/claude-3.5-sonnet': {
                name: 'Claude 3.5 Sonnet',
                cost: { input: 3.0, output: 15.0 },
                contextWindow: 200000,
                capabilities: ['reasoning', 'analysis', 'coding', 'writing'],
                speed: 'medium'
            },
            'google/gemini-2.0-flash-exp:free': {
                name: 'Gemini 2.0 Flash (Free)',
                cost: { input: 0, output: 0 },
                contextWindow: 1000000,
                capabilities: ['general', 'analysis', 'quick-tasks'],
                speed: 'fast'
            },
            'deepseek/deepseek-chat': {
                name: 'DeepSeek Chat',
                cost: { input: 0.14, output: 0.28 },
                contextWindow: 64000,
                capabilities: ['coding', 'reasoning', 'analysis'],
                speed: 'fast'
            },
            'mistralai/mistral-7b-instruct:free': {
                name: 'Mistral 7B (Free)',
                cost: { input: 0, output: 0 },
                contextWindow: 32000,
                capabilities: ['general', 'quick-tasks'],
                speed: 'very-fast'
            },
            'openai/gpt-4o-mini': {
                name: 'GPT-4o Mini',
                cost: { input: 0.15, output: 0.6 },
                contextWindow: 128000,
                capabilities: ['general', 'analysis', 'coding'],
                speed: 'fast'
            }
        };

        this.stats = {
            totalCalls: 0,
            totalCost: 0,
            modelUsage: {},
            errors: 0
        };

        this.loadStats();
    }

    loadStats() {
        const saved = localStorage.getItem('openrouter_stats');
        if (saved) {
            this.stats = JSON.parse(saved);
        }
    }

    saveStats() {
        localStorage.setItem('openrouter_stats', JSON.stringify(this.stats));
    }

    selectModel(taskType, contextLength = 0, maxCost = null) {
        // Default to Aurora Alpha (Amazon Nova Pro)
        let selectedModel = 'amazon/nova-pro-v1';

        // Check if default model can handle the task
        const defaultModelInfo = this.models[selectedModel];

        // If context too large or task requires specific capability, find alternative
        if (contextLength > defaultModelInfo.contextWindow || maxCost !== null) {
            const candidates = Object.entries(this.models)
                .filter(([id, info]) => {
                    const hasCapability = !taskType || info.capabilities.includes(taskType);
                    const fitsContext = contextLength <= info.contextWindow;
                    const withinBudget = maxCost === null || info.cost.input <= maxCost;
                    return hasCapability && fitsContext && withinBudget;
                })
                .sort((a, b) => {
                    // Sort by cost (lower is better)
                    const costA = a[1].cost.input + a[1].cost.output;
                    const costB = b[1].cost.input + b[1].cost.output;
                    return costA - costB;
                });

            if (candidates.length > 0) {
                selectedModel = candidates[0][0];
            }
        }

        addLog('info', `Selected model: ${this.models[selectedModel].name} for task: ${taskType || 'general'}`);
        return selectedModel;
    }

    async chat(messages, options = {}) {
        if (!this.apiKey) {
            addLog('error', 'OpenRouter API key not configured');
            return { success: false, error: 'API key required' };
        }

        const taskType = options.taskType || 'general';
        const contextLength = JSON.stringify(messages).length;
        const model = options.model || this.selectModel(taskType, contextLength, options.maxCost);

        const payload = {
            model: model,
            messages: messages,
            temperature: options.temperature || 0.7,
            max_tokens: options.maxTokens || 4000,
            ...options.params
        };

        try {
            this.stats.totalCalls++;
            this.stats.modelUsage[model] = (this.stats.modelUsage[model] || 0) + 1;

            addLog('info', `OpenRouter chat: ${model}`);

            // Mock response for demo
            const response = await this.mockChatResponse(model, messages);

            // Calculate cost
            const modelInfo = this.models[model];
            const estimatedTokens = contextLength / 4 + 500; // rough estimate
            const cost = (modelInfo.cost.input * estimatedTokens / 1000000) + 
                        (modelInfo.cost.output * 500 / 1000000);

            this.stats.totalCost += cost;
            this.saveStats();

            addLog('success', `Response received. Cost: $${cost.toFixed(6)}`);

            return {
                success: true,
                data: response,
                model: model,
                cost: cost
            };

        } catch (error) {
            this.stats.errors++;
            this.saveStats();
            addLog('error', `OpenRouter error: ${error.message}`);
            return { success: false, error: error.message };
        }
    }

    async mockChatResponse(model, messages) {
        await new Promise(resolve => setTimeout(resolve, 500 + Math.random() * 1000));

        const lastMessage = messages[messages.length - 1];
        const content = lastMessage.content || '';

        return {
            id: 'chatcmpl_' + Math.random().toString(36).substr(2, 9),
            model: model,
            choices: [{
                message: {
                    role: 'assistant',
                    content: `Mock response to: "${content.substring(0, 50)}..." (Model: ${this.models[model].name})`
                },
                finish_reason: 'stop'
            }],
            usage: {
                prompt_tokens: Math.floor(content.length / 4),
                completion_tokens: 100,
                total_tokens: Math.floor(content.length / 4) + 100
            }
        };
    }

    getStats() {
        return {
            ...this.stats,
            avgCostPerCall: this.stats.totalCalls > 0 
                ? (this.stats.totalCost / this.stats.totalCalls).toFixed(6)
                : 0
        };
    }

    updateAPIKey(key) {
        this.apiKey = key;
        localStorage.setItem('api_openrouter_key', key);
        addLog('success', 'OpenRouter API key updated');
    }
}

class NanobotAgent {
    constructor(name, role, llmClient) {
        this.name = name;
        this.role = role;
        this.llm = llmClient;
        this.memory = [];
        this.tools = [];
        this.taskHistory = [];
    }

    registerTool(name, description, handler) {
        this.tools.push({ name, description, handler });
        addLog('info', `Agent ${this.name}: registered tool "${name}"`);
    }

    async think(input, context = {}) {
        const systemPrompt = {
            role: 'system',
            content: `You are ${this.name}, a ${this.role}. ${context.instructions || ''}`
        };

        const messages = [
            systemPrompt,
            ...this.memory.slice(-5), // Keep last 5 exchanges
            { role: 'user', content: input }
        ];

        const response = await this.llm.chat(messages, {
            taskType: context.taskType || 'general',
            temperature: context.temperature || 0.7,
            maxTokens: context.maxTokens || 2000
        });

        if (response.success) {
            const reply = response.data.choices[0].message.content;
            this.memory.push({ role: 'user', content: input });
            this.memory.push({ role: 'assistant', content: reply });

            this.taskHistory.push({
                input: input,
                output: reply,
                model: response.model,
                cost: response.cost,
                timestamp: Date.now()
            });

            return { success: true, response: reply, model: response.model };
        }

        return { success: false, error: response.error };
    }

    async execute(taskName, parameters = {}) {
        const tool = this.tools.find(t => t.name === taskName);

        if (!tool) {
            addLog('warning', `Agent ${this.name}: Unknown task "${taskName}"`);
            return { success: false, error: `Unknown task: ${taskName}` };
        }

        addLog('info', `Agent ${this.name}: Executing "${taskName}"`);

        try {
            const result = await tool.handler(parameters);
            return { success: true, result: result };
        } catch (error) {
            addLog('error', `Agent ${this.name}: Task failed - ${error.message}`);
            return { success: false, error: error.message };
        }
    }

    clearMemory() {
        this.memory = [];
        addLog('info', `Agent ${this.name}: Memory cleared`);
    }

    getStats() {
        const totalCost = this.taskHistory.reduce((sum, t) => sum + (t.cost || 0), 0);
        return {
            name: this.name,
            role: this.role,
            tasksCompleted: this.taskHistory.length,
            totalCost: totalCost.toFixed(6),
            memorySize: this.memory.length,
            tools: this.tools.length
        };
    }
}

class NanobotFramework {
    constructor(openRouterKey) {
        this.llm = new OpenRouterClient(openRouterKey, 'amazon/nova-pro-v1');
        this.agents = new Map();
        this.workflows = new Map();
    }

    createAgent(name, role) {
        const agent = new NanobotAgent(name, role, this.llm);
        this.agents.set(name, agent);
        addLog('success', `Created agent: ${name} (${role})`);
        return agent;
    }

    getAgent(name) {
        return this.agents.get(name);
    }

    registerWorkflow(name, steps) {
        this.workflows.set(name, steps);
        addLog('success', `Registered workflow: ${name} (${steps.length} steps)`);
    }

    async executeWorkflow(workflowName, input) {
        const workflow = this.workflows.get(workflowName);
        if (!workflow) {
            return { success: false, error: `Unknown workflow: ${workflowName}` };
        }

        addLog('info', `Executing workflow: ${workflowName}`);
        const results = [];
        let currentInput = input;

        for (const step of workflow) {
            const agent = this.agents.get(step.agent);
            if (!agent) {
                addLog('error', `Workflow failed: Agent "${step.agent}" not found`);
                return { success: false, error: `Agent not found: ${step.agent}` };
            }

            const result = step.type === 'think' 
                ? await agent.think(currentInput, step.context || {})
                : await agent.execute(step.task, step.parameters || {});

            results.push({ step: step.name, result: result });

            if (!result.success) {
                addLog('error', `Workflow step failed: ${step.name}`);
                return { success: false, error: result.error, results: results };
            }

            currentInput = result.response || result.result;
        }

        addLog('success', `Workflow "${workflowName}" completed successfully`);
        return { success: true, results: results };
    }

    getSystemStats() {
        const llmStats = this.llm.getStats();
        const agentStats = Array.from(this.agents.values()).map(a => a.getStats());

        return {
            llm: llmStats,
            agents: agentStats,
            workflows: this.workflows.size,
            totalAgents: this.agents.size
        };
    }
}

// Initialize global Nanobot framework
let nanobotFramework = null;

function initNanobot() {
    const openRouterKey = localStorage.getItem('api_openrouter_key');
    nanobotFramework = new NanobotFramework(openRouterKey);

    // Create default agents
    const contentAgent = nanobotFramework.createAgent('ContentWriter', 'Content creation specialist');
    contentAgent.registerTool('generatePost', 'Generate social media post', async (params) => {
        return await contentAgent.think(`Create a ${params.platform} post about: ${params.topic}`, {
            taskType: 'writing',
            temperature: 0.8
        });
    });

    const researchAgent = nanobotFramework.createAgent('Researcher', 'Market research analyst');
    researchAgent.registerTool('analyzeCompetitors', 'Analyze competitor data', async (params) => {
        return await researchAgent.think(`Analyze competitors in: ${params.niche}`, {
            taskType: 'analysis'
        });
    });

    const strategyAgent = nanobotFramework.createAgent('Strategist', 'Marketing strategy expert');
    strategyAgent.registerTool('planCampaign', 'Plan marketing campaign', async (params) => {
        return await strategyAgent.think(`Plan a campaign for: ${params.goal}`, {
            taskType: 'reasoning'
        });
    });

    // Register default workflow
    nanobotFramework.registerWorkflow('contentPipeline', [
        { name: 'Research', agent: 'Researcher', type: 'think', context: { taskType: 'analysis' } },
        { name: 'Strategy', agent: 'Strategist', type: 'think', context: { taskType: 'reasoning' } },
        { name: 'Create', agent: 'ContentWriter', type: 'think', context: { taskType: 'writing', temperature: 0.9 } }
    ]);

    addLog('success', 'Nanobot framework initialized with 3 agents');
    return nanobotFramework;
}

    </script>

    <!-- Settings Integration -->
    <script>
        // Settings tab switching
        function switchSettingsTab(tab) {
            // Hide all panels
            document.querySelectorAll('.settings-panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.settings-tab').forEach(t => t.classList.remove('active'));

            // Show selected panel
            document.getElementById(tab + 'Settings').classList.add('active');
            event.target.classList.add('active');
        }

        // Save API Keys
        function saveAPIKeys(event) {
            event.preventDefault();

            const apis = ['amazon', 'hyperbrowser', 'payhip', 'agentmail', 'kie'];
            apis.forEach(api => {
                const key = document.getElementById('api_' + api + '_key').value;
                if (key) {
                    apiManager.updateAPIKey(api, key);
                }
            });

            document.getElementById('successMessage').style.display = 'block';
            setTimeout(() => {
                document.getElementById('successMessage').style.display = 'none';
            }, 3000);

            updateAPIStatusDashboard();
        }

        // Save OpenRouter settings
        function saveOpenRouter(event) {
            event.preventDefault();

            const key = document.getElementById('api_openrouter_key').value;
            const defaultModel = document.getElementById('openrouter_default_model').value;
            const autoSelect = document.getElementById('openrouter_auto_select').checked;
            const maxCost = document.getElementById('openrouter_max_cost').value;

            if (key) {
                if (nanobotFramework) {
                    nanobotFramework.llm.updateAPIKey(key);
                    nanobotFramework.llm.defaultModel = defaultModel;
                } else {
                    localStorage.setItem('api_openrouter_key', key);
                }

                localStorage.setItem('openrouter_default_model', defaultModel);
                localStorage.setItem('openrouter_auto_select', autoSelect);
                localStorage.setItem('openrouter_max_cost', maxCost);

                addLog('success', 'OpenRouter settings saved');
            }

            document.getElementById('successMessage').style.display = 'block';
            setTimeout(() => {
                document.getElementById('successMessage').style.display = 'none';
                updateOpenRouterStats();
            }, 2000);
        }

        // Update API status dashboard
        function updateAPIStatusDashboard() {
            const status = apiManager.getAPIStatus();
            const stats = apiManager.getStats();

            const html = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                    ${Object.entries(status).map(([name, info]) => `
                        <div style="padding: 10px; background: white; border-radius: 6px; border-left: 3px solid ${info.configured ? '#48bb78' : '#f56565'}">
                            <div style="font-weight: 600; margin-bottom: 5px;">${info.name}</div>
                            <div style="font-size: 12px; color: #718096;">
                                Status: ${info.configured ? 'üü¢ Ready' : '‚ö´ Not configured'}<br>
                                Calls: ${info.calls}<br>
                                Rate limit: ${info.remaining}/${info.limit} req/min
                            </div>
                        </div>
                    `).join('')}
                </div>
                <div style="margin-top: 15px; padding: 10px; background: white; border-radius: 6px;">
                    <strong>System Stats:</strong><br>
                    Total requests: ${stats.totalRequests} | 
                    Cache hits: ${stats.cacheHits} (${stats.cacheHitRate}) | 
                    Errors: ${stats.errors}
                </div>
            `;

            document.getElementById('apiStatusDashboard').innerHTML = html;
        }

        // Update OpenRouter stats
        function updateOpenRouterStats() {
            if (!nanobotFramework) return;

            const stats = nanobotFramework.llm.getStats();

            const html = `
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                    <div style="padding: 10px; background: white; border-radius: 6px;">
                        <div style="font-weight: 600; margin-bottom: 5px;">Total Calls</div>
                        <div style="font-size: 24px; color: #667eea;">${stats.totalCalls}</div>
                    </div>
                    <div style="padding: 10px; background: white; border-radius: 6px;">
                        <div style="font-weight: 600; margin-bottom: 5px;">Total Cost</div>
                        <div style="font-size: 24px; color: #667eea;">${stats.totalCost.toFixed(4)}</div>
                    </div>
                </div>
                <div style="margin-top: 10px; padding: 10px; background: white; border-radius: 6px;">
                    <strong>Model Usage:</strong><br>
                    ${Object.entries(stats.modelUsage).map(([model, count]) => 
                        `${model}: ${count} calls`
                    ).join('<br>')}
                </div>
                <div style="margin-top: 10px; padding: 10px; background: white; border-radius: 6px;">
                    Avg cost per call: <strong>$$${stats.avgCostPerCall}</strong>
                </div>
            `;

            document.getElementById('openrouterStats').innerHTML = html;
        }

        // Update agents list
        function updateAgentsList() {
            if (!nanobotFramework) return;

            const stats = nanobotFramework.getSystemStats();

            const html = `
                ${stats.agents.map(agent => `
                    <div style="padding: 15px; background: white; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #667eea;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <div style="font-weight: 600; font-size: 16px;">${agent.name}</div>
                            <div style="font-size: 12px; color: #718096;">${agent.role}</div>
                        </div>
                        <div style="font-size: 13px; color: #718096;">
                            Tasks completed: ${agent.tasksCompleted} | 
                            Total cost: $$${agent.totalCost} | 
                            Tools: ${agent.tools} | 
                            Memory: ${agent.memorySize} items
                        </div>
                    </div>
                `).join('')}
            `;

            document.getElementById('agentsList').innerHTML = html || '<p style="color: #718096;">No agents initialized yet.</p>';
        }

        // Test agent workflow
        async function testAgentWorkflow() {
            if (!nanobotFramework) {
                nanobotFramework = initNanobot();
            }

            addLog('info', 'Testing agent workflow...');
            document.getElementById('workflowResults').style.display = 'block';
            document.getElementById('workflowOutput').textContent = 'Executing workflow...';

            const result = await nanobotFramework.executeWorkflow('contentPipeline', 
                'Create a Reddit post about luxury skincare dupes for anti-aging'
            );

            document.getElementById('workflowOutput').textContent = JSON.stringify(result, null, 2);
            updateAgentsList();
            updateOpenRouterStats();
        }

        // Initialize on settings open
        const originalOpenSettings = openSettings;
        openSettings = function() {
            originalOpenSettings();

            // Load saved values
            const openRouterKey = localStorage.getItem('api_openrouter_key');
            if (openRouterKey) {
                document.getElementById('api_openrouter_key').value = openRouterKey;
            }

            const defaultModel = localStorage.getItem('openrouter_default_model');
            if (defaultModel) {
                document.getElementById('openrouter_default_model').value = defaultModel;
            }

            const autoSelect = localStorage.getItem('openrouter_auto_select');
            if (autoSelect !== null) {
                document.getElementById('openrouter_auto_select').checked = autoSelect === 'true';
            }

            const maxCost = localStorage.getItem('openrouter_max_cost');
            if (maxCost) {
                document.getElementById('openrouter_max_cost').value = maxCost;
            }

            // Update dashboards
            updateAPIStatusDashboard();
            updateOpenRouterStats();
            updateAgentsList();
        };

        // Initialize Nanobot on dashboard load
        setTimeout(() => {
            if (localStorage.getItem('api_openrouter_key')) {
                initNanobot();
                addLog('success', 'Nanobot framework ready');
            }
        }, 2000);
    </script>

</body>
</html>